(function(e){if(false){}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.flvjs=e()}})(function(){var e,t,r;return function e(t,r,i){function n(s,o){if(!r[s]){if(!t[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return n(r?r:e)},f,f.exports,e,t,r,i)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,r,i){(function(n,a){(function(t,n){typeof i==="object"&&typeof r!=="undefined"?r.exports=n():typeof e==="function"&&e.amd?e(n):t.ES6Promise=n()})(this,function(){"use strict";function e(e){return typeof e==="function"||typeof e==="object"&&e!==null}function r(e){return typeof e==="function"}var i=undefined;if(!Array.isArray){i=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}else{i=Array.isArray}var s=i;var o=0;var u=undefined;var l=undefined;var f=function e(t,r){k[o]=t;k[o+1]=r;o+=2;if(o===2){if(l){l(w)}else{O()}}};function d(e){l=e}function h(e){f=e}var c=typeof window!=="undefined"?window:undefined;var _=c||{};var v=_.MutationObserver||_.WebKitMutationObserver;var m=typeof self==="undefined"&&typeof n!=="undefined"&&{}.toString.call(n)==="[object process]";var p=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function g(){return function(){return n.nextTick(w)}}function y(){if(typeof u!=="undefined"){return function(){u(w)}}return S()}function E(){var e=0;var t=new v(w);var r=document.createTextNode("");t.observe(r,{characterData:true});return function(){r.data=e=++e%2}}function b(){var e=new MessageChannel;e.port1.onmessage=w;return function(){return e.port2.postMessage(0)}}function S(){var e=setTimeout;return function(){return e(w,1)}}var k=new Array(1e3);function w(){for(var e=0;e<o;e+=2){var t=k[e];var r=k[e+1];t(r);k[e]=undefined;k[e+1]=undefined}o=0}function L(){try{var e=t;var r=e("vertx");u=r.runOnLoop||r.runOnContext;return y()}catch(e){return S()}}var O=undefined;if(m){O=g()}else if(v){O=E()}else if(p){O=b()}else if(c===undefined&&typeof t==="function"){O=L()}else{O=S()}function T(e,t){var r=arguments;var i=this;var n=new this.constructor(I);if(n[R]===undefined){te(n)}var a=i._state;if(a){(function(){var e=r[a-1];f(function(){return Q(a,n,e,i._result)})})()}else{W(i,n,e,t)}return n}function A(e){var t=this;if(e&&typeof e==="object"&&e.constructor===t){return e}var r=new t(I);z(r,e);return r}var R=Math.random().toString(36).substring(16);function I(){}var C=void 0;var x=1;var M=2;var D=new X;function j(){return new TypeError("You cannot resolve a promise with itself")}function P(){return new TypeError("A promises callback cannot return that same promise.")}function B(e){try{return e.then}catch(e){D.error=e;return D}}function N(e,t,r,i){try{e.call(t,r,i)}catch(e){return e}}function U(e,t,r){f(function(e){var i=false;var n=N(r,t,function(r){if(i){return}i=true;if(t!==r){z(e,r)}else{H(e,r)}},function(t){if(i){return}i=true;K(e,t)},"Settle: "+(e._label||" unknown promise"));if(!i&&n){i=true;K(e,n)}},e)}function F(e,t){if(t._state===x){H(e,t._result)}else if(t._state===M){K(e,t._result)}else{W(t,undefined,function(t){return z(e,t)},function(t){return K(e,t)})}}function G(e,t,i){if(t.constructor===e.constructor&&i===T&&t.constructor.resolve===A){F(e,t)}else{if(i===D){K(e,D.error)}else if(i===undefined){H(e,t)}else if(r(i)){U(e,t,i)}else{H(e,t)}}}function z(t,r){if(t===r){K(t,j())}else if(e(r)){G(t,r,B(r))}else{H(t,r)}}function V(e){if(e._onerror){e._onerror(e._result)}q(e)}function H(e,t){if(e._state!==C){return}e._result=t;e._state=x;if(e._subscribers.length!==0){f(q,e)}}function K(e,t){if(e._state!==C){return}e._state=M;e._result=t;f(V,e)}function W(e,t,r,i){var n=e._subscribers;var a=n.length;e._onerror=null;n[a]=t;n[a+x]=r;n[a+M]=i;if(a===0&&e._state){f(q,e)}}function q(e){var t=e._subscribers;var r=e._state;if(t.length===0){return}var i=undefined,n=undefined,a=e._result;for(var s=0;s<t.length;s+=3){i=t[s];n=t[s+r];if(i){Q(r,i,n,a)}else{n(a)}}e._subscribers.length=0}function X(){this.error=null}var Y=new X;function Z(e,t){try{return e(t)}catch(e){Y.error=e;return Y}}function Q(e,t,i,n){var a=r(i),s=undefined,o=undefined,u=undefined,l=undefined;if(a){s=Z(i,n);if(s===Y){l=true;o=s.error;s=null}else{u=true}if(t===s){K(t,P());return}}else{s=n;u=true}if(t._state!==C){}else if(a&&u){z(t,s)}else if(l){K(t,o)}else if(e===x){H(t,s)}else if(e===M){K(t,s)}}function J(e,t){try{t(function t(r){z(e,r)},function t(r){K(e,r)})}catch(t){K(e,t)}}var $=0;function ee(){return $++}function te(e){e[R]=$++;e._state=undefined;e._result=undefined;e._subscribers=[]}function re(e,t){this._instanceConstructor=e;this.promise=new e(I);if(!this.promise[R]){te(this.promise)}if(s(t)){this._input=t;this.length=t.length;this._remaining=t.length;this._result=new Array(this.length);if(this.length===0){H(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){H(this.promise,this._result)}}}else{K(this.promise,ie())}}function ie(){return new Error("Array Methods must be provided an Array")}re.prototype._enumerate=function(){var e=this.length;var t=this._input;for(var r=0;this._state===C&&r<e;r++){this._eachEntry(t[r],r)}};re.prototype._eachEntry=function(e,t){var r=this._instanceConstructor;var i=r.resolve;if(i===A){var n=B(e);if(n===T&&e._state!==C){this._settledAt(e._state,t,e._result)}else if(typeof n!=="function"){this._remaining--;this._result[t]=e}else if(r===le){var a=new r(I);G(a,e,n);this._willSettleAt(a,t)}else{this._willSettleAt(new r(function(t){return t(e)}),t)}}else{this._willSettleAt(i(e),t)}};re.prototype._settledAt=function(e,t,r){var i=this.promise;if(i._state===C){this._remaining--;if(e===M){K(i,r)}else{this._result[t]=r}}if(this._remaining===0){H(i,this._result)}};re.prototype._willSettleAt=function(e,t){var r=this;W(e,undefined,function(e){return r._settledAt(x,t,e)},function(e){return r._settledAt(M,t,e)})};function ne(e){return new re(this,e).promise}function ae(e){var t=this;if(!s(e)){return new t(function(e,t){return t(new TypeError("You must pass an array to race."))})}else{return new t(function(r,i){var n=e.length;for(var a=0;a<n;a++){t.resolve(e[a]).then(r,i)}})}}function se(e){var t=this;var r=new t(I);K(r,e);return r}function oe(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ue(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function le(e){this[R]=ee();this._result=this._state=undefined;this._subscribers=[];if(I!==e){typeof e!=="function"&&oe();this instanceof le?J(this,e):ue()}}le.all=ne;le.race=ae;le.resolve=A;le.reject=se;le._setScheduler=d;le._setAsap=h;le._asap=f;le.prototype={constructor:le,then:T,catch:function e(t){return this.then(null,t)}};function fe(){var e=undefined;if(typeof a!=="undefined"){e=a}else if(typeof self!=="undefined"){e=self}else{try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if(r==="[object Promise]"&&!t.cast){return}}e.Promise=le}le.polyfill=fe;le.Promise=le;return le})}).call(this,t("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:3}],2:[function(e,t,r){function i(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=i;i.EventEmitter=i;i.prototype._events=undefined;i.prototype._maxListeners=undefined;i.defaultMaxListeners=10;i.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};i.prototype.emit=function(e){var t,r,i,a,u,l;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||s(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var f=new Error('Uncaught, unspecified "error" event. ('+t+")");f.context=t;throw f}}}r=this._events[e];if(o(r))return false;if(n(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1);r.apply(this,a)}}else if(s(r)){a=Array.prototype.slice.call(arguments,1);l=r.slice();i=l.length;for(u=0;u<i;u++)l[u].apply(this,a)}return true};i.prototype.addListener=function(e,t){var r;if(!n(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,n(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(s(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(s(this._events[e])&&!this._events[e].warned){if(!o(this._maxListeners)){r=this._maxListeners}else{r=i.defaultMaxListeners}if(r&&r>0&&this._events[e].length>r){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};i.prototype.on=i.prototype.addListener;i.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=false;function i(){this.removeListener(e,i);if(!r){r=true;t.apply(this,arguments)}}i.listener=t;this.on(e,i);return this};i.prototype.removeListener=function(e,t){var r,i,a,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;r=this._events[e];a=r.length;i=-1;if(r===t||n(r.listener)&&r.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(s(r)){for(o=a;o-- >0;){if(r[o]===t||r[o].listener&&r[o].listener===t){i=o;break}}if(i<0)return this;if(r.length===1){r.length=0;delete this._events[e]}else{r.splice(i,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}r=this._events[e];if(n(r)){this.removeListener(e,r)}else if(r){while(r.length)this.removeListener(e,r[r.length-1])}delete this._events[e];return this};i.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(n(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;else if(t)return t.length}return 0};i.listenerCount=function(e,t){return e.listenerCount(t)};function n(e){return typeof e==="function"}function a(e){return typeof e==="number"}function s(e){return typeof e==="object"&&e!==null}function o(e){return e===void 0}},{}],3:[function(e,t,r){var i=t.exports={};var n;var a;function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){n=setTimeout}else{n=s}}catch(e){n=s}try{if(typeof clearTimeout==="function"){a=clearTimeout}else{a=o}}catch(e){a=o}})();function u(e){if(n===setTimeout){return setTimeout(e,0)}if((n===s||!n)&&setTimeout){n=setTimeout;return setTimeout(e,0)}try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function l(e){if(a===clearTimeout){return clearTimeout(e)}if((a===o||!a)&&clearTimeout){a=clearTimeout;return clearTimeout(e)}try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}var f=[];var d=false;var h;var c=-1;function _(){if(!d||!h){return}d=false;if(h.length){f=h.concat(f)}else{c=-1}if(f.length){v()}}function v(){if(d){return}var e=u(_);d=true;var t=f.length;while(t){h=f;f=[];while(++c<t){if(h){h[c].run()}}c=-1;t=f.length}h=null;d=false;l(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}f.push(new m(e,t));if(f.length===1&&!d){u(v)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function p(){}i.on=p;i.addListener=p;i.once=p;i.off=p;i.removeListener=p;i.removeAllListeners=p;i.emit=p;i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],4:[function(e,t,r){var i=arguments[3];var n=arguments[4];var a=arguments[5];var s=JSON.stringify;t.exports=function(e,t){var r;var o=Object.keys(a);for(var u=0,l=o.length;u<l;u++){var f=o[u];var d=a[f].exports;if(d===e||d&&d.default===e){r=f;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};for(var u=0,l=o.length;u<l;u++){var f=o[u];h[f]=f}n[r]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var _={};_[r]=r;n[c]=[Function(["require"],"var f = require("+s(r)+");"+"(f.default ? f.default : f)(self);"),_];var v={};m(c);function m(e){v[e]=true;for(var t in n[e][1]){var r=n[e][1][t];if(!v[r]){m(r)}}}var p="("+i+")({"+Object.keys(v).map(function(e){return s(e)+":["+n[e][0]+","+s(n[e][1])+"]"}).join(",")+"},{},["+s(c)+"])";var g=window.URL||window.webkitURL||window.mozURL||window.msURL;var y=new Blob([p],{type:"text/javascript"});if(t&&t.bare){return y}var E=g.createObjectURL(y);var b=new Worker(E);b.objectURL=E;return b}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.createDefaultConfig=n;var i=r.defaultConfig={enableWorker:false,enableStashBuffer:true,stashInitialSize:undefined,isLive:false,lazyLoad:true,lazyLoadMaxDuration:3*60,deferLoadAfterSourceOpen:true,statisticsInfoReportInterval:600,accurateSeek:false,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:false,customSeekHandler:undefined};function n(){return Object.assign({},i)}},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("../io/io-controller.js");var a=o(n);var s=e("../config.js");function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function e(){u(this,e)}i(e,null,[{key:"supportMSEH264Playback",value:function e(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function e(){var t=new a.default({},(0,s.createDefaultConfig)());var r=t.loaderType;t.destroy();return r=="fetch-stream-loader"||r=="xhr-moz-chunked-loader"}},{key:"getNetworkLoaderTypeName",value:function e(){var t=new a.default({},(0,s.createDefaultConfig)());var r=t.loaderType;t.destroy();return r}},{key:"supportNativeMediaPlayback",value:function t(r){if(e.videoElement==undefined){e.videoElement=window.document.createElement("video")}var i=e.videoElement.canPlayType(r);return i==="probably"||i=="maybe"}},{key:"getFeatureList",value:function t(){var r={mseFlvPlayback:false,mseLiveFlvPlayback:false,networkStreamIO:false,networkLoaderName:"",nativeMP4H264Playback:false,nativeWebmVP8Playback:false,nativeWebmVP9Playback:false};r.mseFlvPlayback=e.supportMSEH264Playback();r.networkStreamIO=e.supportNetworkStreamIO();r.networkLoaderName=e.getNetworkLoaderTypeName();r.mseLiveFlvPlayback=r.mseFlvPlayback&&r.networkStreamIO;r.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"');r.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"');r.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"');return r}}]);return e}();r.default=l},{"../config.js":5,"../io/io-controller.js":23}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.mimeType=null;this.duration=null;this.hasAudio=null;this.hasVideo=null;this.audioCodec=null;this.videoCodec=null;this.audioDataRate=null;this.videoDataRate=null;this.audioSampleRate=null;this.audioChannelCount=null;this.width=null;this.height=null;this.fps=null;this.profile=null;this.level=null;this.chromaFormat=null;this.sarNum=null;this.sarDen=null;this.metadata=null;this.segments=null;this.segmentCount=null;this.hasKeyframesIndex=null;this.keyframesIndex=null}i(e,[{key:"isComplete",value:function e(){var t=this.hasAudio===false||this.hasAudio===true&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null;var r=this.hasVideo===false||this.hasVideo===true&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&t&&r}},{key:"isSeekable",value:function e(){return this.hasKeyframesIndex===true}},{key:"getNearestKeyframe",value:function e(t){if(this.keyframesIndex==null){return null}var r=this.keyframesIndex;var i=this._search(r.times,t);return{index:i,milliseconds:r.times[i],fileposition:r.filepositions[i]}}},{key:"_search",value:function e(t,r){var i=0;var n=t.length-1;var a=0;var s=0;var o=n;if(r<t[0]){i=0;s=o+1}while(s<=o){a=s+Math.floor((o-s)/2);if(a===n||r>=t[a]&&r<t[a+1]){i=a;break}else if(t[a]<r){s=a+1}else{o=a-1}}return i}}]);return e}();r.default=a},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=r.SampleInfo=function e(t,r,i,a,s){n(this,e);this.dts=t;this.pts=r;this.duration=i;this.originalDts=a;this.isSyncPoint=s;this.fileposition=null};var s=r.MediaSegmentInfo=function(){function e(){n(this,e);this.beginDts=0;this.endDts=0;this.beginPts=0;this.endPts=0;this.originalBeginDts=0;this.originalEndDts=0;this.syncPoints=[];this.firstSample=null;this.lastSample=null}i(e,[{key:"appendSyncPoint",value:function e(t){t.isSyncPoint=true;this.syncPoints.push(t)}}]);return e}();var o=r.IDRSampleList=function(){function e(){n(this,e);this._list=[]}i(e,[{key:"clear",value:function e(){this._list=[]}},{key:"appendArray",value:function e(t){var r=this._list;if(t.length===0){return}if(r.length>0&&t[0].originalDts<r[r.length-1].originalDts){this.clear()}Array.prototype.push.apply(r,t)}},{key:"getLastSyncPointBeforeDts",value:function e(t){if(this._list.length==0){return null}var r=this._list;var i=0;var n=r.length-1;var a=0;var s=0;var o=n;if(t<r[0].dts){i=0;s=o+1}while(s<=o){a=s+Math.floor((o-s)/2);if(a===n||t>=r[a].dts&&t<r[a+1].dts){i=a;break}else if(r[a].dts<t){s=a+1}else{o=a-1}}return this._list[i]}}]);return e}();var u=r.MediaSegmentInfoList=function(){function e(t){n(this,e);this._type=t;this._list=[];this._lastAppendLocation=-1}i(e,[{key:"isEmpty",value:function e(){return this._list.length===0}},{key:"clear",value:function e(){this._list=[];this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function e(t){var r=this._list;if(r.length===0){return-2}var i=r.length-1;var n=0;var a=0;var s=i;var o=0;if(t<r[0].originalBeginDts){o=-1;return o}while(a<=s){n=a+Math.floor((s-a)/2);if(n===i||t>r[n].lastSample.originalDts&&t<r[n+1].originalBeginDts){o=n;break}else if(r[n].originalBeginDts<t){a=n+1}else{s=n-1}}return o}},{key:"_searchNearestSegmentAfter",value:function e(t){return this._searchNearestSegmentBefore(t)+1}},{key:"append",value:function e(t){var r=this._list;var i=t;var n=this._lastAppendLocation;var a=0;if(n!==-1&&n<r.length&&i.originalBeginDts>=r[n].lastSample.originalDts&&(n===r.length-1||n<r.length-1&&i.originalBeginDts<r[n+1].originalBeginDts)){a=n+1}else{if(r.length>0){a=this._searchNearestSegmentBefore(i.originalBeginDts)+1}}this._lastAppendLocation=a;this._list.splice(a,0,i)}},{key:"getLastSegmentBefore",value:function e(t){var r=this._searchNearestSegmentBefore(t);if(r>=0){return this._list[r]}else{return null}}},{key:"getLastSampleBefore",value:function e(t){var r=this.getLastSegmentBefore(t);if(r!=null){return r.lastSample}else{return null}}},{key:"getLastSyncPointBefore",value:function e(t){var r=this._searchNearestSegmentBefore(t);var i=this._list[r].syncPoints;while(i.length===0&&r>0){r--;i=this._list[r].syncPoints}if(i.length>0){return i[i.length-1]}else{return null}}},{key:"type",get:function e(){return this._type}},{key:"length",get:function e(){return this._list.length}}]);return e}()},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("events");var a=_(n);var s=e("../utils/logger.js");var o=_(s);var u=e("../utils/browser.js");var l=_(u);var f=e("./mse-events.js");var d=_(f);var h=e("./media-segment-info.js");var c=e("../utils/exception.js");function _(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var m=function(){function e(){v(this,e);this.TAG="MSEController";this._emitter=new a.default;this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)};this._mediaSource=null;this._mediaSourceObjectURL=null;this._mediaElement=null;this._isBufferFull=false;this._hasPendingEos=false;this._pendingSourceBufferInit=[];this._mimeTypes={video:null,audio:null};this._sourceBuffers={video:null,audio:null};this._lastInitSegments={video:null,audio:null};this._pendingSegments={video:[],audio:[]};this._pendingRemoveRanges={video:[],audio:[]};this._idrList=new h.IDRSampleList}i(e,[{key:"destroy",value:function e(){if(this._mediaElement||this._mediaSource){this.detachMediaElement()}this.e=null;this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"attachMediaElement",value:function e(t){if(this._mediaSource){throw new c.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!")}var r=this._mediaSource=new window.MediaSource;r.addEventListener("sourceopen",this.e.onSourceOpen);r.addEventListener("sourceended",this.e.onSourceEnded);r.addEventListener("sourceclose",this.e.onSourceClose);this._mediaElement=t;this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource);t.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function e(){if(this._mediaSource){var t=this._mediaSource;for(var r in this._sourceBuffers){var i=this._pendingSegments[r];i.splice(0,i.length);this._pendingSegments[r]=null;this._pendingRemoveRanges[r]=null;this._lastInitSegments[r]=null;var n=this._sourceBuffers[r];if(n){if(t.readyState!=="closed"){t.removeSourceBuffer(n);n.removeEventListener("error",this.e.onSourceBufferError);n.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[r]=null;this._sourceBuffers[r]=null}}if(t.readyState==="open"){try{t.endOfStream()}catch(e){o.default.e(this.TAG,e.message)}}t.removeEventListener("sourceopen",this.e.onSourceOpen);t.removeEventListener("sourceended",this.e.onSourceEnded);t.removeEventListener("sourceclose",this.e.onSourceClose);this._pendingSourceBufferInit=[];this._isBufferFull=false;this._idrList.clear();this._mediaSource=null}if(this._mediaElement){this._mediaElement.src="";this._mediaElement.removeAttribute("src");this._mediaElement=null}if(this._mediaSourceObjectURL){window.URL.revokeObjectURL(this._mediaSourceObjectURL);this._mediaSourceObjectURL=null}}},{key:"appendInitSegment",value:function e(t,r){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t);this._pendingSegments[t.type].push(t);return}var i=t;var n=i.container+";codecs="+i.codec;var a=false;o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+n);this._lastInitSegments[i.type]=i;if(n!==this._mimeTypes[i.type]){if(!this._mimeTypes[i.type]){a=true;try{var s=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(n);s.addEventListener("error",this.e.onSourceBufferError);s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){o.default.e(this.TAG,e.message);this._emitter.emit(d.default.ERROR,{code:e.code,msg:e.message});return}}else{o.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+n)}this._mimeTypes[i.type]=n}if(!r){this._pendingSegments[i.type].push(i)}if(!a){if(this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating){this._doAppendSegments()}}}},{key:"appendMediaSegment",value:function e(t){var r=t;this._pendingSegments[r.type].push(r);var i=this._sourceBuffers[r.type];if(i&&!i.updating&&!this._hasPendingRemoveRanges()){this._doAppendSegments()}}},{key:"seek",value:function e(t){for(var r in this._sourceBuffers){if(!this._sourceBuffers[r]){continue}var i=this._sourceBuffers[r];if(this._mediaSource.readyState==="open"){try{i.abort()}catch(e){o.default.e(this.TAG,e.message)}}this._idrList.clear();var n=this._pendingSegments[r];n.splice(0,n.length);if(this._mediaSource.readyState==="closed"){continue}for(var a=0;a<i.buffered.length;a++){var s=i.buffered.start(a);var u=i.buffered.end(a);this._pendingRemoveRanges[r].push({start:s,end:u})}if(!i.updating){this._doRemoveRanges()}if(l.default.safari){var f=this._lastInitSegments[r];if(f){this._pendingSegments[r].push(f);if(!i.updating){this._doAppendSegments()}}}}}},{key:"endOfStream",value:function e(){var t=this._mediaSource;var r=this._sourceBuffers;if(!t||t.readyState!=="open"){if(t&&t.readyState==="closed"&&this._hasPendingSegments()){this._hasPendingEos=true}return}if(r.video&&r.video.updating||r.audio&&r.audio.updating){this._hasPendingEos=true}else{this._hasPendingEos=false;t.endOfStream()}}},{key:"getNearestKeyframe",value:function e(t){return this._idrList.getLastSyncPointBeforeDts(t)}},{key:"update",value:function e(t){function r(e){var t=e;var r=["video","audio"];for(var i=0;i<r.length;i++){var n=t._sourceBuffers[r[i]];if(!n)continue;var a=0;var s=0;for(var o=0;o<n.buffered.length;o++){a=n.buffered.start(o);s=n.buffered.end(o);console.debug(r[i]+"start:"+a+"end:"+s)}}console.debug("time:"+t._mediaElement.currentTime)}function i(e){var t=e;var r=["video","audio"];for(var i=0;i<r.length;i++){var n=t._sourceBuffers[r[i]];if(!n)continue;for(var a=0;a<n.buffered.length;a++){var s=n.buffered.start(a);var o=n.buffered.end(a);t._pendingRemoveRanges[r[i]].push({start:s,end:o})}}}if(t){var n=["video","audio"];var a=0;var s=0;for(var o=0;o<n.length;o++){var u=this._sourceBuffers[n[o]];if(!u)continue;for(var l=0;l<u.buffered.length;l++){if(a==0)a=u.buffered.start(l);else a=Math.min(u.buffered.start(l),a);s=Math.max(u.buffered.end(l),s)}}if(s-a>20){for(var o=0;o<n.length;o++){var u=this._sourceBuffers[n[o]];if(!u)continue;var f=s-10;this._pendingRemoveRanges[n[o]].push({start:0,end:f});this._doRemoveRanges()}}{if(this._mediaElement.currentTime>s+2){this._mediaElement.currentTime=s-.2}if(s-this._mediaElement.currentTime>4){this._mediaElement.currentTime=s-.5}if(s-this._mediaElement.currentTime>10){}if(this._mediaElement.playbackRate==2){if(s-this._mediaElement.currentTime<1)this._mediaElement.playbackRate=1}}}}},{key:"log",value:function e(){var t=this;var r=["video","audio"];var i;for(var n=0;n<r.length;n++){var a=t._sourceBuffers[r[n]];if(!a)continue;var s=0;var u=0;for(var l=0;l<a.buffered.length;l++){s=a.buffered.start(l);u=a.buffered.end(l);var f=r[n]+"start:"+s+"end:"+u;i=i+" "+f}}o.default.v(this.TAG,"time:"+t._mediaElement.currentTime+" "+i)}},{key:"_doRemoveRanges",value:function e(){for(var t in this._pendingRemoveRanges){if(!this._sourceBuffers[t]||this._sourceBuffers[t].updating){continue}var r=this._sourceBuffers[t];var i=this._pendingRemoveRanges[t];while(i.length&&!r.updating){var n=i.shift();r.remove(n.start,n.end)}}}},{key:"_doAppendSegments",value:function e(){var t=this._pendingSegments;for(var r in t){if(!this._sourceBuffers[r]||this._sourceBuffers[r].updating){continue}if(t[r].length>0){var i=t[r].shift();try{this._sourceBuffers[r].appendBuffer(i.data);this._isBufferFull=false;if(r==="video"&&i.hasOwnProperty("info")){this._idrList.appendArray(i.info.syncPoints)}}catch(e){this._pendingSegments[r].unshift(i);if(e.code===22){if(!this._isBufferFull){this._emitter.emit(d.default.BUFFER_FULL)}this._isBufferFull=true}else{o.default.e(this.TAG,e.message);this._emitter.emit(d.default.ERROR,{code:e.code,msg:e.message})}}}}}},{key:"_onSourceOpen",value:function e(){o.default.v(this.TAG,"MediaSource onSourceOpen");this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen);if(this._pendingSourceBufferInit.length>0){var t=this._pendingSourceBufferInit;while(t.length){var r=t.shift();this.appendInitSegment(r,true)}}if(this._hasPendingSegments()){this._doAppendSegments()}this._emitter.emit(d.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function e(){o.default.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function e(){o.default.v(this.TAG,"MediaSource onSourceClose");if(this._mediaSource&&this.e!=null){this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen);this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded);this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose)}}},{key:"_hasPendingSegments",value:function e(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function e(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function e(){if(this._hasPendingRemoveRanges()){this._doRemoveRanges()}else if(this._hasPendingSegments()){this._doAppendSegments()}else if(this._hasPendingEos){this.endOfStream()}this._emitter.emit(d.default.UPDATE_END)}},{key:"_onSourceBufferError",
value:function e(t){o.default.e(this.TAG,"SourceBuffer Error: "+t)}}]);return e}();r.default=m},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};r.default=i},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("events");var a=g(n);var s=e("../utils/logger.js");var o=g(s);var u=e("../utils/logging-control.js");var l=g(u);var f=e("./transmuxing-controller.js");var d=g(f);var h=e("./transmuxing-events.js");var c=g(h);var _=e("./transmuxing-worker.js");var v=g(_);var m=e("./media-info.js");var p=g(m);function g(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var E=function(){function t(r,i){y(this,t);this.TAG="Transmuxer";this._emitter=new a.default;if(i.enableWorker&&typeof Worker!=="undefined"){try{var n=e("webworkify");this._worker=n(v.default);this._workerDestroying=false;this._worker.addEventListener("message",this._onWorkerMessage.bind(this));this._worker.postMessage({cmd:"init",param:[r,i]});this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)};l.default.registerListener(this.e.onLoggingConfigChanged);this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch(e){o.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing");this._worker=null;this._controller=new d.default(r,i)}}else{this._controller=new d.default(r,i)}if(this._controller){var s=this._controller;s.on(c.default.IO_ERROR,this._onIOError.bind(this));s.on(c.default.DEMUX_ERROR,this._onDemuxError.bind(this));s.on(c.default.INIT_SEGMENT,this._onInitSegment.bind(this));s.on(c.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this));s.on(c.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this));s.on(c.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this));s.on(c.default.MEDIA_INFO,this._onMediaInfo.bind(this));s.on(c.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this));s.on(c.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}i(t,[{key:"destroy",value:function e(){if(this._worker){if(!this._workerDestroying){this._workerDestroying=true;this._worker.postMessage({cmd:"destroy"});l.default.removeListener(this.e.onLoggingConfigChanged);this.e=null}}else{this._controller.destroy();this._controller=null}this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"hasWorker",value:function e(){return this._worker!=null}},{key:"open",value:function e(){if(this._worker){this._worker.postMessage({cmd:"start"})}else{this._controller.start()}}},{key:"close",value:function e(){if(this._worker){this._worker.postMessage({cmd:"stop"})}else{this._controller.stop()}}},{key:"seek",value:function e(t){if(this._worker){this._worker.postMessage({cmd:"seek",param:t})}else{this._controller.seek(t)}}},{key:"pause",value:function e(){if(this._worker){this._worker.postMessage({cmd:"pause"})}else{this._controller.pause()}}},{key:"resume",value:function e(t){if(this._worker){this._worker.postMessage({cmd:"resume"})}else{this._controller.resume(t)}}},{key:"_onInitSegment",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.INIT_SEGMENT,t,r)})}},{key:"_onMediaSegment",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.MEDIA_SEGMENT,t,r)})}},{key:"_onLoadingComplete",value:function e(){var t=this;Promise.resolve().then(function(){t._emitter.emit(c.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function e(){var t=this;Promise.resolve().then(function(){t._emitter.emit(c.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.MEDIA_INFO,t)})}},{key:"_onStatisticsInfo",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.STATISTICS_INFO,t)})}},{key:"_onIOError",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.IO_ERROR,t,r)})}},{key:"_onDemuxError",value:function e(t,r){var i=this;Promise.resolve().then(function(){i._emitter.emit(c.default.DEMUX_ERROR,t,r)})}},{key:"_onRecommendSeekpoint",value:function e(t){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.RECOMMEND_SEEKPOINT,t)})}},{key:"_onLoggingConfigChanged",value:function e(t){if(this._worker){this._worker.postMessage({cmd:"logging_config",param:t})}}},{key:"_onWorkerMessage",value:function e(t){var r=t.data;var i=r.data;if(r.msg==="destroyed"||this._workerDestroying){this._workerDestroying=false;this._worker.terminate();this._worker=null;return}switch(r.msg){case c.default.INIT_SEGMENT:case c.default.MEDIA_SEGMENT:this._emitter.emit(r.msg,i.type,i.data);break;case c.default.LOADING_COMPLETE:case c.default.RECOVERED_EARLY_EOF:this._emitter.emit(r.msg);break;case c.default.MEDIA_INFO:Object.setPrototypeOf(i,p.default.prototype);this._emitter.emit(r.msg,i);break;case c.default.STATISTICS_INFO:this._emitter.emit(r.msg,i);break;case c.default.IO_ERROR:case c.default.DEMUX_ERROR:this._emitter.emit(r.msg,i.type,i.info);break;case c.default.RECOMMEND_SEEKPOINT:this._emitter.emit(r.msg,i);break;default:break}}}]);return t}();r.default=E},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("events");var a=k(n);var s=e("../utils/logger.js");var o=k(s);var u=e("../utils/browser.js");var l=k(u);var f=e("./media-info.js");var d=k(f);var h=e("../demux/flv-demuxer.js");var c=k(h);var _=e("../remux/mp4-remuxer.js");var v=k(_);var m=e("../demux/demux-errors.js");var p=k(m);var g=e("../io/io-controller.js");var y=k(g);var E=e("./transmuxing-events.js");var b=k(E);var S=e("../io/loader.js");function k(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var L=function(){function e(t,r){w(this,e);this.TAG="TransmuxingController";this._emitter=new a.default;this._config=r;if(!t.segments){t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]}if(typeof t.cors!=="boolean"){t.cors=true}if(typeof t.withCredentials!=="boolean"){t.withCredentials=false}this._mediaDataSource=t;this._currentSegmentIndex=0;var i=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=i;i+=e.duration;e.cors=t.cors;e.withCredentials=t.withCredentials});if(!isNaN(i)&&this._mediaDataSource.duration!==i){this._mediaDataSource.duration=i}this._mediaInfo=null;this._demuxer=null;this._remuxer=null;this._ioctl=null;this._pendingSeekTime=null;this._pendingResolveSeekPoint=null;this._statisticsReporter=null}i(e,[{key:"destroy",value:function e(){this._mediaInfo=null;this._mediaDataSource=null;if(this._statisticsReporter){this._disableStatisticsReporter()}if(this._ioctl){this._ioctl.destroy();this._ioctl=null}if(this._demuxer){this._demuxer.destroy();this._demuxer=null}if(this._remuxer){this._remuxer.destroy();this._remuxer=null}this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"start",value:function e(){this._loadSegment(0);this._enableStatisticsReporter()}},{key:"_loadSegment",value:function e(t,r){this._currentSegmentIndex=t;var i=this._mediaDataSource.segments[t];var n=this._ioctl=new y.default(i,this._config,t);n.onError=this._onIOException.bind(this);n.onSeeked=this._onIOSeeked.bind(this);n.onComplete=this._onIOComplete.bind(this);n.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this);if(r){this._demuxer.bindDataSource(this._ioctl)}else{n.onDataArrival=this._onInitChunkArrival.bind(this)}n.open(r)}},{key:"stop",value:function e(){this._internalAbort();this._disableStatisticsReporter()}},{key:"_internalAbort",value:function e(){if(this._ioctl){this._ioctl.destroy();this._ioctl=null}}},{key:"pause",value:function e(){if(this._ioctl&&this._ioctl.isWorking()){this._ioctl.pause();this._disableStatisticsReporter()}}},{key:"resume",value:function e(t){if(this._ioctl&&this._ioctl.isPaused()){this._ioctl.resume(t);this._enableStatisticsReporter()}}},{key:"seek",value:function e(t){if(!this._config.isLive){if(this._mediaInfo==undefined){this._pendingSeekTime=t}else{this._remuxer.seek(t);this._ioctl.seek(t);this._pendingResolveSeekPoint=t}return}if(this._mediaInfo==null||!this._mediaInfo.isSeekable()){return}var r=this._searchSegmentIndexContains(t);if(r===this._currentSegmentIndex){var i=this._mediaInfo.segments[r];if(i==undefined){this._pendingSeekTime=t}else{var n=i.getNearestKeyframe(t);this._remuxer.seek(n.milliseconds);this._ioctl.seek(n.fileposition);this._pendingResolveSeekPoint=n.milliseconds}}else{var a=this._mediaInfo.segments[r];if(a==undefined){this._pendingSeekTime=t;this._internalAbort();this._remuxer.seek();this._remuxer.insertDiscontinuity();this._loadSegment(r)}else{var s=a.getNearestKeyframe(t);this._internalAbort();this._remuxer.seek(t);this._remuxer.insertDiscontinuity();this._demuxer.resetMediaInfo();this._demuxer.timestampBase=this._mediaDataSource.segments[r].timestampBase;this._loadSegment(r,s.fileposition);this._pendingResolveSeekPoint=s.milliseconds;this._reportSegmentMediaInfo(r)}}this._enableStatisticsReporter()}},{key:"_searchSegmentIndexContains",value:function e(t){var r=this._mediaDataSource.segments;var i=r.length-1;for(var n=0;n<r.length;n++){if(t<r[n].timestampBase){i=n-1;break}}return i}},{key:"_onInitChunkArrival",value:function e(t,r){var i=this;var n=null;var a=0;if(r>0){this._demuxer.bindDataSource(this._ioctl);this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase;a=this._demuxer.parseChunks(t,r)}else if((n=c.default.probe(t)).match){this._demuxer=new c.default(n,this._config);if(!this._remuxer){this._remuxer=new v.default(this._config)}var s=this._mediaDataSource;if(s.duration!=undefined&&!isNaN(s.duration)){this._demuxer.overridedDuration=s.duration}this._demuxer.timestampBase=s.segments[this._currentSegmentIndex].timestampBase;this._demuxer.onError=this._onDemuxException.bind(this);this._demuxer.onMediaInfo=this._onMediaInfo.bind(this);this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl));this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this);this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this);a=this._demuxer.parseChunks(t,r)}else{n=null;o.default.e(this.TAG,"Non-FLV, Unsupported media type!");Promise.resolve().then(function(){i._internalAbort()});this._emitter.emit(b.default.DEMUX_ERROR,p.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type");a=0}return a}},{key:"_onMediaInfo",value:function e(t){var r=this;if(this._mediaInfo==null){this._mediaInfo=Object.assign({},t);this._mediaInfo.keyframesIndex=null;this._mediaInfo.segments=[];this._mediaInfo.segmentCount=this._mediaDataSource.segments.length;Object.setPrototypeOf(this._mediaInfo,d.default.prototype)}var i=Object.assign({},t);Object.setPrototypeOf(i,d.default.prototype);this._mediaInfo.segments[this._currentSegmentIndex]=i;this._reportSegmentMediaInfo(this._currentSegmentIndex);if(this._pendingSeekTime!=null){Promise.resolve().then(function(){var e=r._pendingSeekTime;r._pendingSeekTime=null;r.seek(e)})}}},{key:"_onIOSeeked",value:function e(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function e(t){var r=t;var i=r+1;if(i<this._mediaDataSource.segments.length){this._internalAbort();this._loadSegment(i)}else{this._emitter.emit(b.default.LOADING_COMPLETE);this._disableStatisticsReporter()}}},{key:"_onIORecoveredEarlyEof",value:function e(){this._emitter.emit(b.default.RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function e(t,r){o.default.e(this.TAG,"IOException: type = "+t+", code = "+r.code+", msg = "+r.msg);this._emitter.emit(b.default.IO_ERROR,t,r);this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function e(t,r){o.default.e(this.TAG,"DemuxException: type = "+t+", info = "+r);this._emitter.emit(b.default.DEMUX_ERROR,t,r)}},{key:"_onRemuxerInitSegmentArrival",value:function e(t,r){this._emitter.emit(b.default.INIT_SEGMENT,t,r)}},{key:"_onRemuxerMediaSegmentArrival",value:function e(t,r){if(this._pendingSeekTime!=null){return}this._emitter.emit(b.default.MEDIA_SEGMENT,t,r);if(this._pendingResolveSeekPoint!=null&&t==="video"){var i=r.info.syncPoints;var n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null;if(l.default.safari&&i.length>0&&i[0].originalDts===n){n=i[0].pts}this._emitter.emit(b.default.RECOMMEND_SEEKPOINT,n)}}},{key:"_enableStatisticsReporter",value:function e(){if(this._statisticsReporter==null){this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}}},{key:"_disableStatisticsReporter",value:function e(){if(this._statisticsReporter){self.clearInterval(this._statisticsReporter);this._statisticsReporter=null}}},{key:"_reportSegmentMediaInfo",value:function e(t){var r=this._mediaInfo.segments[t];var i=Object.assign({},r);i.duration=this._mediaInfo.duration;i.segmentCount=this._mediaInfo.segmentCount;delete i.segments;delete i.keyframesIndex;this._emitter.emit(b.default.MEDIA_INFO,i)}},{key:"_reportStatisticsInfo",value:function e(){var t={};t.url=this._ioctl.currentUrl;t.speed=this._ioctl.currentSpeed;t.loaderType=this._ioctl.loaderType;t.currentSegmentIndex=this._currentSegmentIndex;t.totalSegmentCount=this._mediaDataSource.segments.length;this._emitter.emit(b.default.STATISTICS_INFO,t)}}]);return e}();r.default=L},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};r.default=i},{}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../utils/logger.js");var n=c(i);var a=e("../utils/logging-control.js");var s=c(a);var o=e("../utils/polyfill.js");var u=c(o);var l=e("./transmuxing-controller.js");var f=c(l);var d=e("./transmuxing-events.js");var h=c(d);function c(e){return e&&e.__esModule?e:{default:e}}var _=function e(t){var r="TransmuxingWorker";var i=null;u.default.install();t.addEventListener("message",function(e){switch(e.data.cmd){case"init":i=new f.default(e.data.param[0],e.data.param[1]);i.on(h.default.IO_ERROR,_.bind(this));i.on(h.default.DEMUX_ERROR,v.bind(this));i.on(h.default.INIT_SEGMENT,n.bind(this));i.on(h.default.MEDIA_SEGMENT,a.bind(this));i.on(h.default.LOADING_COMPLETE,o.bind(this));i.on(h.default.RECOVERED_EARLY_EOF,l.bind(this));i.on(h.default.MEDIA_INFO,d.bind(this));i.on(h.default.STATISTICS_INFO,c.bind(this));i.on(h.default.RECOMMEND_SEEKPOINT,m.bind(this));break;case"destroy":if(i){i.destroy();i=null}t.postMessage({msg:"destroyed"});break;case"start":i.start();break;case"stop":i.stop();break;case"seek":i.seek(e.data.param);break;case"pause":i.pause();break;case"resume":i.resume();break;case"logging_config":s.default.applyConfig(e.data.param);break}});function n(e,r){var i={msg:h.default.INIT_SEGMENT,data:{type:e,data:r}};t.postMessage(i,[r.data])}function a(e,r){var i={msg:h.default.MEDIA_SEGMENT,data:{type:e,data:r}};t.postMessage(i,[r.data])}function o(){var e={msg:h.default.LOADING_COMPLETE};t.postMessage(e)}function l(){var e={msg:h.default.RECOVERED_EARLY_EOF};t.postMessage(e)}function d(e){var r={msg:h.default.MEDIA_INFO,data:e};t.postMessage(r)}function c(e){var r={msg:h.default.STATISTICS_INFO,data:e};t.postMessage(r)}function _(e,r){t.postMessage({msg:h.default.IO_ERROR,data:{type:e,info:r}})}function v(e,r){t.postMessage({msg:h.default.DEMUX_ERROR,data:{type:e,info:r}})}function m(e){t.postMessage({msg:h.default.RECOMMEND_SEEKPOINT,data:e})}};r.default=_},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("../utils/logger.js");var a=l(n);var s=e("../utils/utf8-conv.js");var o=l(s);var u=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=function(){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,true);return new Int16Array(e)[0]===256}();var h=function(){function e(){f(this,e)}i(e,null,[{key:"parseScriptData",value:function t(r,i,n){var s={};try{var o=e.parseValue(r,i,n);var u=e.parseValue(r,i+o.size,n-o.size);s[o.data]=u.data}catch(e){a.default.e("AMF",e.toString())}return s}},{key:"parseObject",value:function t(r,i,n){if(n<3){throw new u.IllegalStateException("Data not enough when parse ScriptDataObject")}var a=e.parseString(r,i,n);var s=e.parseValue(r,i+a.size,n-a.size);var o=s.objectEnd;return{data:{name:a.data,value:s.data},size:a.size+s.size,objectEnd:o}}},{key:"parseVariable",value:function t(r,i,n){return e.parseObject(r,i,n)}},{key:"parseString",value:function e(t,r,i){if(i<2){throw new u.IllegalStateException("Data not enough when parse String")}var n=new DataView(t,r,i);var a=n.getUint16(0,!d);var s=void 0;if(a>0){s=(0,o.default)(new Uint8Array(t,r+2,a))}else{s=""}return{data:s,size:2+a}}},{key:"parseLongString",value:function e(t,r,i){if(i<4){throw new u.IllegalStateException("Data not enough when parse LongString")}var n=new DataView(t,r,i);var a=n.getUint32(0,!d);var s=void 0;if(a>0){s=(0,o.default)(new Uint8Array(t,r+4,a))}else{s=""}return{data:s,size:4+a}}},{key:"parseDate",value:function e(t,r,i){if(i<10){throw new u.IllegalStateException("Data size invalid when parse Date")}var n=new DataView(t,r,i);var a=n.getFloat64(0,!d);var s=n.getInt16(8,!d);a+=s*60*1e3;return{data:new Date(a),size:8+2}}},{key:"parseValue",value:function t(r,i,n){if(n<1){throw new u.IllegalStateException("Data not enough when parse Value")}var s=new DataView(r,i,n);var o=1;var l=s.getUint8(0);var f=void 0;var h=false;try{switch(l){case 0:f=s.getFloat64(1,!d);o+=8;break;case 1:{var c=s.getUint8(1);f=c?true:false;o+=1;break}case 2:{var _=e.parseString(r,i+1,n-1);f=_.data;o+=_.size;break}case 3:{f={};var v=0;if((s.getUint32(n-4,!d)&16777215)===9){v=3}while(o<n-4){var m=e.parseObject(r,i+o,n-o-v);if(m.objectEnd)break;f[m.data.name]=m.data.value;o+=m.size}if(o<=n-3){var p=s.getUint32(o-1,!d)&16777215;if(p===9){o+=3}}break}case 8:{f={};o+=4;var g=0;if((s.getUint32(n-4,!d)&16777215)===9){g=3}while(o<n-8){var y=e.parseVariable(r,i+o,n-o-g);if(y.objectEnd)break;f[y.data.name]=y.data.value;o+=y.size}if(o<=n-3){var E=s.getUint32(o-1,!d)&16777215;if(E===9){o+=3}}break}case 9:f=undefined;o=1;h=true;break;case 10:{f=[];var b=s.getUint32(1,!d);o+=4;for(var S=0;S<b;S++){var k=e.parseValue(r,i+o,n-o);f.push(k.data);o+=k.size}break}case 11:{var w=e.parseDate(r,i+1,n-1);f=w.data;o+=w.size;break}case 12:{var L=e.parseString(r,i+1,n-1);f=L.data;o+=L.size;break}default:o=n;a.default.w("AMF","Unsupported AMF value type "+l)}}catch(e){a.default.e("AMF",e.toString())}return{data:f,size:o,objectEnd:h}}}]);return e}();r.default=h},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};r.default=i},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("../utils/exception.js");function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function e(t){a(this,e);this.TAG="ExpGolomb";this._buffer=t;this._buffer_index=0;this._total_bytes=t.byteLength;this._total_bits=t.byteLength*8;this._current_word=0;this._current_word_bits_left=0}i(e,[{key:"destroy",value:function e(){this._buffer=null}},{key:"_fillCurrentWord",value:function e(){var t=this._total_bytes-this._buffer_index;if(t<=0)throw new n.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var r=Math.min(4,t);var i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+r));this._current_word=new DataView(i.buffer).getUint32(0,false);this._buffer_index+=r;this._current_word_bits_left=r*8}},{key:"readBits",value:function e(t){if(t>32)throw new n.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(t<=this._current_word_bits_left){var r=this._current_word>>>32-t;this._current_word<<=t;this._current_word_bits_left-=t;return r}var i=this._current_word_bits_left?this._current_word:0;i=i>>>32-this._current_word_bits_left;var a=t-this._current_word_bits_left;this._fillCurrentWord();var s=Math.min(a,this._current_word_bits_left);var o=this._current_word>>>32-s;this._current_word<<=s;this._current_word_bits_left-=s;i=i<<s|o;return i}},{key:"readBool",value:function e(){return this.readBits(1)===1}},{key:"readByte",value:function e(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function e(){var t=void 0;for(t=0;t<this._current_word_bits_left;t++){if(0!==(this._current_word&2147483648>>>t)){this._current_word<<=t;this._current_word_bits_left-=t;return t}}this._fillCurrentWord();return t+this._skipLeadingZero()}},{key:"readUEG",value:function e(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function e(){var t=this.readUEG();if(t&1){return t+1>>>1}else{return-1*(t>>>1)}}}]);return e}();r.default=s},{"../utils/exception.js":40}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=e("../utils/logger.js");var s=m(a);var o=e("./amf-parser.js");var u=m(o);var l=e("./sps-parser.js");var f=m(l);var d=e("./demux-errors.js");var h=m(d);var c=e("../core/media-info.js");var _=m(c);var v=e("../utils/exception.js");function m(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e){return e>>>8&255|(e&255)<<8}function y(e){return(e&4278190080)>>>24|(e&16711680)>>>8|(e&65280)<<8|(e&255)<<24}function E(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}var b=function(){function e(t,r){p(this,e);this.TAG="FLVDemuxer";this._config=r;this._onError=null;this._onMediaInfo=null;this._onTrackMetadata=null;this._onDataAvailable=null;this._dataOffset=t.dataOffset;this._firstParse=true;this._dispatch=false;this._hasAudio=t.hasAudioTrack;this._hasVideo=t.hasVideoTrack;this._audioInitialMetadataDispatched=false;this._videoInitialMetadataDispatched=false;this._mediaInfo=new _.default;this._mediaInfo.hasAudio=this._hasAudio;this._mediaInfo.hasVideo=this._hasVideo;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._naluLengthSize=4;this._timestampBase=0;this._timescale=1e3;this._duration=0;this._durationOverrided=false;this._referenceFrameRate={fixed:true,fps:23.976,fps_num:23976,fps_den:1e3};this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0};this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};this._littleEndian=function(){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,true);return new Int16Array(e)[0]===256}()}n(e,[{key:"destroy",value:function e(){this._mediaInfo=null;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._videoTrack=null;this._audioTrack=null;this._onError=null;this._onMediaInfo=null;this._onTrackMetadata=null;this._onDataAvailable=null}},{key:"bindDataSource",value:function e(t){t.onDataArrival=this.parseChunks.bind(this);return this}},{key:"resetMediaInfo",value:function e(){this._mediaInfo=new _.default}},{key:"_isInitialMetadataDispatched",value:function e(){if(this._hasAudio&&this._hasVideo){return this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched}if(this._hasAudio&&!this._hasVideo){return this._audioInitialMetadataDispatched}if(!this._hasAudio&&this._hasVideo){return this._videoInitialMetadataDispatched}}},{key:"parseChunks",value:function t(r,i){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable){throw new v.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified")}var n=0;var a=this._littleEndian;if(i===0){if(r.byteLength>13){var o=e.probe(r);n=o.dataOffset;i=o.dataOffset}else{return 0}}if(this._firstParse){this._firstParse=false;if(i!==this._dataOffset){s.default.w(this.TAG,"First time parsing but chunk byteStart invalid!")}var u=new DataView(r,n);var l=u.getUint32(0,!a);if(l!==0){s.default.w(this.TAG,"PrevTagSize0 !== 0 !!!")}n+=4}while(n<r.byteLength){this._dispatch=true;var f=new DataView(r,n);if(n+11+4>r.byteLength){break}var d=f.getUint8(0);var h=f.getUint32(0,!a)&16777215;if(n+11+h+4>r.byteLength){break}if(d!==8&&d!==9&&d!==18){s.default.w(this.TAG,"Unsupported tag type "+d+", skipped");n+=11+h+4;continue}var c=f.getUint8(4);var _=f.getUint8(5);var m=f.getUint8(6);var p=f.getUint8(7);var g=m|_<<8|c<<16|p<<24;var y=f.getUint32(7,!a)&16777215;if(y!==0){s.default.w(this.TAG,"Meet tag which has StreamID != 0!")}var E=n+11;switch(d){case 8:this._parseAudioData(r,E,h,g);break;case 9:this._parseVideoData(r,E,h,g,i+n);break;case 18:this._parseScriptData(r,E,h);break}var b=f.getUint32(11+h,!a);if(b!==11+h){s.default.w(this.TAG,"Invalid PrevTagSize "+b)}n+=11+h+4}if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack)}}return n}},{key:"_parseScriptData",value:function e(t,r,n){var a=u.default.parseScriptData(t,r,n);if(a.hasOwnProperty("onMetaData")){if(this._metadata){s.default.w(this.TAG,"Found another onMetaData tag!")}this._metadata=a;var o=this._metadata.onMetaData;if(typeof o.hasAudio==="boolean"){this._hasAudio=o.hasAudio;this._mediaInfo.hasAudio=this._hasAudio}if(typeof o.hasVideo==="boolean"){this._hasVideo=o.hasVideo;this._mediaInfo.hasVideo=this._hasVideo}if(typeof o.audiodatarate==="number"){this._mediaInfo.audioDataRate=o.audiodatarate}if(typeof o.videodatarate==="number"){this._mediaInfo.videoDataRate=o.videodatarate}if(typeof o.width==="number"){this._mediaInfo.width=o.width}if(typeof o.height==="number"){this._mediaInfo.height=o.height}if(typeof o.duration==="number"){if(!this._durationOverrided){var l=Math.floor(o.duration*this._timescale);this._duration=l;this._mediaInfo.duration=l}}else{this._mediaInfo.duration=0}if(typeof o.framerate==="number"){var f=Math.floor(o.framerate*1e3);if(f>0){var d=f/1e3;this._referenceFrameRate.fixed=true;this._referenceFrameRate.fps=d;this._referenceFrameRate.fps_num=f;this._referenceFrameRate.fps_den=1e3;this._mediaInfo.fps=d}}if(i(o.keyframes)==="object"){this._mediaInfo.hasKeyframesIndex=true;var h=o.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(h);o.keyframes=null}else{this._mediaInfo.hasKeyframesIndex=false}this._dispatch=false;this._mediaInfo.metadata=o;s.default.v(this.TAG,"Parsed onMetaData");if(this._mediaInfo.isComplete()){this._onMediaInfo(this._mediaInfo)}}}},{key:"_parseKeyframesIndex",value:function e(t){var r=[];var i=[];for(var n=1;n<t.times.length;n++){var a=this._timestampBase+Math.floor(t.times[n]*1e3);r.push(a);i.push(t.filepositions[n])}return{times:r,filepositions:i}}},{key:"_parseAudioData",value:function e(t,r,i,n){if(i<=1){s.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}var a=this._audioMetadata;var o=this._audioTrack;if(!a||!a.codec){a=this._audioMetadata={};a.type="audio";a.id=o.id;a.timescale=this._timescale;a.duration=this._duration;var u=this._littleEndian;var l=new DataView(t,r,i);var f=l.getUint8(0);var d=f>>>4;if(d!==10){this._onError(h.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+d);return}var c=0;var _=(f&12)>>>2;var v=[5500,11025,22050,44100,48e3];if(_<v.length){c=v[_]}else{this._onError(h.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+_);return}var m=(f&2)>>>1;var p=f&1;a.audioSampleRate=c;a.channelCount=p===0?1:2;a.refSampleDuration=Math.floor(1024/a.audioSampleRate*a.timescale);a.codec="mp4a.40.5"}var g=this._parseAACAudioData(t,r+1,i-1);if(g==undefined){return}if(g.packetType===0){if(a.config){s.default.w(this.TAG,"Found another AudioSpecificConfig!")}var y=g.data;a.audioSampleRate=y.samplingRate;a.channelCount=y.channelCount;a.codec=y.codec;a.config=y.config;a.refSampleDuration=Math.floor(1024/a.audioSampleRate*a.timescale);s.default.v(this.TAG,"Parsed AudioSpecificConfig");if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack)}}else{this._audioInitialMetadataDispatched=true}this._dispatch=false;this._onTrackMetadata("audio",a);var E=this._mediaInfo;E.audioCodec="mp4a.40."+y.originalAudioObjectType;E.audioSampleRate=a.audioSampleRate;E.audioChannelCount=a.channelCount;if(E.hasVideo){if(E.videoCodec!=null){E.mimeType='video/x-flv; codecs="'+E.videoCodec+","+E.audioCodec+'"'}}else{E.mimeType='video/x-flv; codecs="'+E.audioCodec+'"'}if(E.isComplete()){this._onMediaInfo(E)}return}else if(g.packetType===1){var b=this._timestampBase+n;var S={unit:g.data,dts:b,pts:b};o.samples.push(S);o.length+=g.data.length}else{s.default.e(this.TAG,"Flv: Unsupported AAC data type "+g.packetType)}}},{key:"_parseAACAudioData",value:function e(t,r,i){if(i<=1){
s.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var n={};var a=new Uint8Array(t,r,i);n.packetType=a[0];if(a[0]===0){n.data=this._parseAACAudioSpecificConfig(t,r+1,i-1)}else{n.data=a.subarray(1)}return n}},{key:"_parseAACAudioSpecificConfig",value:function e(t,r,i){var n=new Uint8Array(t,r,i);var a=null;var s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var o=0;var u=0;var l=null;var f=0;var d=null;o=u=n[0]>>>3;f=(n[0]&7)<<1|n[1]>>>7;if(f<0||f>=s.length){this._onError(h.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var c=s[f];var _=(n[1]&120)>>>3;if(_<0||_>=8){this._onError(h.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}if(o===5){d=(n[1]&7)<<1|n[2]>>>7;l=(n[2]&124)>>>2}var v=self.navigator.userAgent.toLowerCase();if(v.indexOf("firefox")!==-1){if(f>=6){o=5;a=new Array(4);d=f-3}else{o=2;a=new Array(2);d=f}}else if(v.indexOf("android")!==-1){o=2;a=new Array(2);d=f}else{o=5;d=f;a=new Array(4);if(f>=6){d=f-3}else if(_===1){o=2;a=new Array(2);d=f}}a[0]=o<<3;a[0]|=(f&15)>>>1;a[1]=(f&15)<<7;a[1]|=(_&15)<<3;if(o===5){a[1]|=(d&15)>>>1;a[2]=(d&1)<<7;a[2]|=2<<2;a[3]=0}return{config:a,samplingRate:c,channelCount:_,codec:"mp4a.40."+o,originalAudioObjectType:u}}},{key:"_parseVideoData",value:function e(t,r,i,n,a){if(i<=1){s.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}var o=new Uint8Array(t,r,i)[0];var u=(o&240)>>>4;var l=o&15;if(l!==7){this._onError(h.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+l);return}this._parseAVCVideoPacket(t,r+1,i-1,n,a,u)}},{key:"_parseAVCVideoPacket",value:function e(t,r,i,n,a,o){if(i<4){s.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var u=this._littleEndian;var l=new DataView(t,r,i);var f=l.getUint8(0);var d=l.getUint32(0,!u)&16777215;if(f===0){this._parseAVCDecoderConfigurationRecord(t,r+4,i-4)}else if(f===1){this._parseAVCVideoData(t,r+4,i-4,n,a,o,d)}else if(f===2){}else{this._onError(h.default.FORMAT_ERROR,"Flv: Invalid video packet type "+f);return}}},{key:"_parseAVCDecoderConfigurationRecord",value:function e(t,r,i){if(i<7){s.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var n=this._videoMetadata;var a=this._videoTrack;var o=this._littleEndian;var u=new DataView(t,r,i);if(!n){n=this._videoMetadata={};n.type="video";n.id=a.id;n.timescale=this._timescale;n.duration=this._duration}else{if(typeof n.avcc!=="undefined"){s.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!")}}var l=u.getUint8(0);var d=u.getUint8(1);var c=u.getUint8(2);var _=u.getUint8(3);if(l!==1||d===0){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}this._naluLengthSize=(u.getUint8(4)&3)+1;if(this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(h.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var v=u.getUint8(5)&31;if(v===0||v>1){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid H264 SPS count: "+v);return}var m=6;for(var p=0;p<v;p++){var g=u.getUint16(m,!o);m+=2;if(g===0){continue}var y=new Uint8Array(t,r+m,g);m+=g;var E=f.default.parseSPS(y);n.codecWidth=E.codec_size.width;n.codecHeight=E.codec_size.height;n.presentWidth=E.present_size.width;n.presentHeight=E.present_size.height;n.profile=E.profile_string;n.level=E.level_string;n.bitDepth=E.bit_depth;n.chromaFormat=E.chroma_format;n.sarRatio=E.sar_ratio;n.frameRate=E.frame_rate;if(E.frame_rate.fixed===false||E.frame_rate.fps_num===0||E.frame_rate.fps_den===0){n.frameRate=this._referenceFrameRate}var b=n.frameRate.fps_den;var S=n.frameRate.fps_num;n.refSampleDuration=Math.floor(n.timescale*(b/S));var k=y.subarray(1,4);var w="avc1.";for(var L=0;L<3;L++){var O=k[L].toString(16);if(O.length<2){O="0"+O}w+=O}n.codec=w;var T=this._mediaInfo;T.width=n.codecWidth;T.height=n.codecHeight;T.fps=n.frameRate.fps;T.profile=n.profile;T.level=n.level;T.chromaFormat=E.chroma_format_string;T.sarNum=n.sarRatio.width;T.sarDen=n.sarRatio.height;T.videoCodec=w;if(T.hasAudio){if(T.audioCodec!=null){T.mimeType='video/x-flv; codecs="'+T.videoCodec+","+T.audioCodec+'"'}}else{T.mimeType='video/x-flv; codecs="'+T.videoCodec+'"'}if(T.isComplete()){this._onMediaInfo(T)}}var A=u.getUint8(m);if(A===0||A>1){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid H264 PPS count: "+A);return}m++;for(var R=0;R<A;R++){var I=u.getUint16(m,!o);m+=2;if(I===0){continue}m+=I}n.avcc=new Uint8Array(i);n.avcc.set(new Uint8Array(t,r,i),0);s.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord");if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack)}}else{this._videoInitialMetadataDispatched=true}this._dispatch=false;this._onTrackMetadata("video",n)}},{key:"_parseAVCVideoData",value:function e(t,r,i,n,a,o,u){var l=this._littleEndian;var f=new DataView(t,r,i);var d=[],h=0;var c=0;var _=this._naluLengthSize;var v=this._timestampBase+n;var m=o===1;while(c<i){if(c+4>=i){s.default.w(this.TAG,"Malformed Nalu near timestamp "+v+", offset = "+c+", dataSize = "+i);break}var p=f.getUint32(c,!l);if(_===3){p>>>=8}if(p>i-_){s.default.w(this.TAG,"Malformed Nalus near timestamp "+v+", NaluSize > DataSize!");return}var g=f.getUint8(c+_)&31;if(g===5){m=true}var y=new Uint8Array(t,r+c,_+p);var E={type:g,data:y};d.push(E);h+=y.byteLength;c+=_+p}if(d.length){var b=this._videoTrack;var S={units:d,length:h,isKeyframe:m,dts:v,cts:u,pts:v+u};if(m){S.fileposition=a}b.samples.push(S);b.length+=h}}},{key:"onTrackMetadata",get:function e(){return this._onTrackMetadata},set:function e(t){this._onTrackMetadata=t}},{key:"onMediaInfo",get:function e(){return this._onMediaInfo},set:function e(t){this._onMediaInfo=t}},{key:"onError",get:function e(){return this._onError},set:function e(t){this._onError=t}},{key:"onDataAvailable",get:function e(){return this._onDataAvailable},set:function e(t){this._onDataAvailable=t}},{key:"timestampBase",get:function e(){return this._timestampBase},set:function e(t){this._timestampBase=t}},{key:"overridedDuration",get:function e(){return this._duration},set:function e(t){this._durationOverrided=true;this._duration=t;this._mediaInfo.duration=t}}],[{key:"probe",value:function e(t){var r=new Uint8Array(t);var i={match:false};if(r[0]!==70||r[1]!==76||r[2]!==86||r[3]!==1){return i}var n=(r[4]&4)>>>2!==0;var a=(r[4]&1)!==0;if(!n&&!a){return i}var s=E(r,5);if(s<9){return i}return{match:true,consumed:s,dataOffset:s,hasAudioTrack:n,hasVideoTrack:a}}}]);return e}();r.default=b},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("./exp-golomb.js");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var u=function(){function e(){o(this,e)}i(e,null,[{key:"_ebsp2rbsp",value:function e(t){var r=t;var i=r.byteLength;var n=new Uint8Array(i);var a=0;for(var s=0;s<i;s++){if(s>=2){if(r[s]===3&&r[s-1]===0&&r[s-2]===0){continue}}n[a]=r[s];a++}return new Uint8Array(n.buffer,0,a)}},{key:"parseSPS",value:function t(r){var i=e._ebsp2rbsp(r);var n=new a.default(i);n.readByte();var s=n.readByte();n.readByte();var o=n.readByte();n.readUEG();var u=e.getProfileString(s);var l=e.getLevelString(o);var f=1;var d=420;var h=[0,420,422,444];var c=8;if(s===100||s===110||s===122||s===244||s===44||s===83||s===86||s===118||s===128||s===138||s===144){f=n.readUEG();if(f===3){n.readBits(1)}if(f<=3){d=h[f]}c=n.readUEG()+8;n.readUEG();n.readBits(1);if(n.readBool()){var _=f!==3?8:12;for(var v=0;v<_;v++){if(n.readBool()){if(v<6){e._skipScalingList(n,16)}else{e._skipScalingList(n,64)}}}}}n.readUEG();var m=n.readUEG();if(m===0){n.readUEG()}else if(m===1){n.readBits(1);n.readSEG();n.readSEG();var p=n.readUEG();for(var g=0;g<p;g++){n.readSEG()}}n.readUEG();n.readBits(1);var y=n.readUEG();var E=n.readUEG();var b=n.readBits(1);if(b===0){n.readBits(1)}n.readBits(1);var S=0;var k=0;var w=0;var L=0;var O=n.readBool();if(O){S=n.readUEG();k=n.readUEG();w=n.readUEG();L=n.readUEG()}var T=1,A=1;var R=0,I=true,C=0,x=0;var M=n.readBool();if(M){if(n.readBool()){var D=n.readByte();var j=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2];var P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];if(D>0&&D<16){T=j[D-1];A=P[D-1]}else if(D===255){T=n.readByte()<<8|n.readByte();A=n.readByte()<<8|n.readByte()}}if(n.readBool()){n.readBool()}if(n.readBool()){n.readBits(4);if(n.readBool()){n.readBits(24)}}if(n.readBool()){n.readUEG();n.readUEG()}if(n.readBool()){var B=n.readBits(32);var N=n.readBits(32);I=n.readBool();C=N;x=B*2;R=C/x}}var U=1;if(T!==1||A!==1){U=T/A}var F=0,G=0;if(f===0){F=1;G=2-b}else{var z=f===3?1:2;var V=f===1?2:1;F=z;G=V*(2-b)}var H=(y+1)*16;var K=(2-b)*((E+1)*16);H-=(S+k)*F;K-=(w+L)*G;var W=Math.ceil(H*U);n.destroy();n=null;return{profile_string:u,level_string:l,bit_depth:c,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:I,fps:R,fps_den:x,fps_num:C},sar_ratio:{width:T,height:A},codec_size:{width:H,height:K},present_size:{width:W,height:K}}}},{key:"_skipScalingList",value:function e(t,r){var i=8,n=8;var a=0;for(var s=0;s<r;s++){if(n!==0){a=t.readSEG();n=(i+a+256)%256}i=n===0?i:n}}},{key:"getProfileString",value:function e(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function e(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function e(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]);return e}();r.default=u},{"./exp-golomb.js":17}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=e("./utils/polyfill.js");var a=g(n);var s=e("./core/features.js");var o=g(s);var u=e("./player/flv-player.js");var l=g(u);var f=e("./player/native-player.js");var d=g(f);var h=e("./player/player-events.js");var c=g(h);var _=e("./player/player-errors.js");var v=e("./utils/logging-control.js");var m=g(v);var p=e("./utils/exception.js");function g(e){return e&&e.__esModule?e:{default:e}}a.default.install();function y(e,t){var r=e;if(r==null||(typeof r==="undefined"?"undefined":i(r))!=="object"){throw new p.InvalidArgumentException("MediaDataSource must be an javascript object!")}if(!r.hasOwnProperty("type")){throw new p.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!")}switch(r.type){case"flv":return new l.default(r,t);default:return new d.default(r,t)}}function E(){return o.default.supportMSEH264Playback()}function b(){return o.default.getFeatureList()}var S={};S.createPlayer=y;S.isSupported=E;S.getFeatureList=b;S.Events=c.default;S.ErrorTypes=_.ErrorTypes;S.ErrorDetails=_.ErrorDetails;S.FlvPlayer=l.default;S.NativePlayer=d.default;S.LoggingControl=m.default;Object.defineProperty(S,"version",{enumerable:true,get:function e(){return"1.1.0"}});r.default=S},{"./core/features.js":6,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(e,t,r){"use strict";t.exports=e("./flv.js").default},{"./flv.js":20}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var s=e("../utils/logger.js");var o=h(s);var u=e("../utils/browser.js");var l=h(u);var f=e("./loader.js");var d=e("../utils/exception.js");function h(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){v(t,e);a(t,null,[{key:"isSupported",value:function e(){try{return self.fetch&&self.ReadableStream&&!l.default.msedge}catch(e){return false}}}]);function t(e){c(this,t);var r=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fetch-stream-loader"));r.TAG="FetchStreamLoader";r._seekHandler=e;r._needStash=true;r._requestAbort=false;r._contentLength=null;r._receivedLength=0;return r}a(t,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){var n=this;this._dataSource=t;this._range=r;var a=this._seekHandler.getConfig(t.url,r);var s=new self.Headers;if(i(a.headers)==="object"){var o=a.headers;for(var u in o){if(o.hasOwnProperty(u)){s.append(u,o[u])}}}var l=a.url;var h={method:"GET",headers:s,mode:"cors",cache:"default"};if(t.cors===false){h.mode="same-origin"}if(t.withCredentials){h.credentials="include"}this._status=f.LoaderStatus.kConnecting;self.fetch(l,h).then(function(e){if(n._requestAbort){n._requestAbort=false;n._status=f.LoaderStatus.kIdle;return}if(e.ok&&e.status>=200&&e.status<=299){var t=e.headers.get("Content-Length");if(t!=null){n._contentLength=parseInt(t);if(n._contentLength!==0){if(n._onContentLengthKnown){n._onContentLengthKnown(n._contentLength)}}}return n._pump.call(n,e.body.getReader())}else{n._status=f.LoaderStatus.kError;if(n._onError){n._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}else{throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText)}}}).catch(function(e){n._status=f.LoaderStatus.kError;if(n._onError){n._onError(f.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}else{throw e}})}},{key:"pause",value:function e(e){this._paused=e;if(!e&&this.reader)this._pump(this.reader)}},{key:"abort",value:function e(){this._requestAbort=true}},{key:"_pump",value:function e(t){var r=this;this.reader=t;return t.read().then(function(e){if(e.done){r._status=f.LoaderStatus.kComplete;if(r._onComplete){r._onComplete(r._range.from,r._range.from+r._receivedLength-1)}}else{if(r._requestAbort===true){r._requestAbort=false;r._status=f.LoaderStatus.kComplete;return t.cancel()}r._status=f.LoaderStatus.kBuffering;var i=e.value.buffer;var n=r._range.from+r._receivedLength;r._receivedLength+=i.byteLength;if(r._onDataArrival){r._onDataArrival(i,n,r._receivedLength)}if(r._paused)return;r._pump(t)}}).catch(function(e){r._status=f.LoaderStatus.kError;var t=0;var i=null;if(e.code===19&&(r._contentLength===null||r._contentLength!==null&&r._receivedLength<r._contentLength)){t=f.LoaderErrors.EARLY_EOF;i={code:e.code,msg:"Fetch stream meet Early-EOF"}}else{t=f.LoaderErrors.EXCEPTION;i={code:e.code,msg:e.message}}if(r._onError){r._onError(t,i)}else{throw new d.RuntimeException(i.msg)}})}}]);return t}(f.BaseLoader);r.default=m},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("../utils/logger.js");var a=w(n);var s=e("./speed-sampler.js");var o=w(s);var u=e("./loader.js");var l=e("./fetch-stream-loader.js");var f=w(l);var d=e("./xhr-moz-chunked-loader.js");var h=w(d);var c=e("./xhr-msstream-loader.js");var _=w(c);var v=e("./xhr-range-loader.js");var m=w(v);var p=e("./websocket-loader.js");var g=w(p);var y=e("./range-seek-handler.js");var E=w(y);var b=e("./param-seek-handler.js");var S=w(b);var k=e("../utils/exception.js");function w(e){return e&&e.__esModule?e:{default:e}}function L(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var O=function(){function e(t,r,i){L(this,e);this.TAG="IOController";this._config=r;this._extraData=i;this._stashInitialSize=1024*384;if(r.isLive===true){this._stashInitialSize=1024*512}if(r.stashInitialSize!=undefined&&r.stashInitialSize>0){this._stashInitialSize=r.stashInitialSize}this._stashUsed=0;this._stashSize=this._stashInitialSize;this._bufferSize=1024*1024*3;this._stashBuffer=new ArrayBuffer(this._bufferSize);this._stashByteStart=0;this._enableStash=true;if(r.enableStashBuffer===false){this._enableStash=false}this._loader=null;this._loaderClass=null;this._seekHandler=null;this._dataSource=t;this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url);this._refTotalLength=t.filesize?t.filesize:null;this._totalLength=this._refTotalLength;this._fullRequestFlag=false;this._currentRange=null;this._speedNormalized=0;this._speedSampler=new o.default;this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096];this._isEarlyEofReconnecting=false;this._paused=false;this._resumeFrom=0;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRecoveredEarlyEof=null;this._selectSeekHandler();this._selectLoader();this._createLoader()}i(e,[{key:"destroy",value:function e(){if(this._loader.isWorking()){this._loader.abort()}this._loader.destroy();this._loader=null;this._loaderClass=null;this._dataSource=null;this._stashBuffer=null;this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0;this._currentRange=null;this._speedSampler=null;this._isEarlyEofReconnecting=false;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRecoveredEarlyEof=null;this._extraData=null}},{key:"isWorking",value:function e(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function e(){return this._paused}},{key:"_selectSeekHandler",value:function e(){var t=this._config;if(t.seekType==="range"){this._seekHandler=new E.default(this._config.rangeLoadZeroStart)}else if(t.seekType==="param"){var r=t.seekParamStart||"bstart";var i=t.seekParamEnd||"bend";this._seekHandler=new S.default(r,i)}else if(t.seekType==="custom"){if(typeof t.customSeekHandler!=="function"){throw new k.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!")}this._seekHandler=new t.customSeekHandler}else{throw new k.InvalidArgumentException("Invalid seekType in config: "+t.seekType)}}},{key:"_selectLoader",value:function e(){if(this._isWebSocketURL){this._loaderClass=g.default}else if(f.default.isSupported()){this._loaderClass=f.default}else if(h.default.isSupported()){this._loaderClass=h.default}else if(m.default.isSupported()){this._loaderClass=m.default}else{throw new k.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")}}},{key:"_createLoader",value:function e(){this._loader=new this._loaderClass(this._seekHandler);if(this._loader.needStashBuffer===false){this._enableStash=false}this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this);this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this);this._loader.onComplete=this._onLoaderComplete.bind(this);this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function e(t){this._currentRange={from:0,to:-1};if(t){this._currentRange.from=t}this._speedSampler.reset();if(!t){this._fullRequestFlag=true}this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function e(){this._loader.abort();if(this._paused){this._paused=false;this._resumeFrom=0}}},{key:"pause",value:function e(){this._loader.pause(true);this._paused=true}},{key:"resume",value:function e(t){if(this._paused){this._loader.pause(false);this._paused=false}}},{key:"seek",value:function e(t){this._paused=false;this._stashUsed=0;this._stashByteStart=0;this._internalSeek(t,true)}},{key:"_internalSeek",value:function e(t,r){if(this._loader.isWorking()){this._loader.abort()}this._flushStashBuffer(r);this._loader.destroy();this._loader=null;var i={from:t,to:-1};this._currentRange={from:i.from,to:-1};this._speedSampler.reset();this._stashSize=this._stashInitialSize;this._createLoader();this._loader.open(this._dataSource,i);if(this._onSeeked){this._onSeeked()}}},{key:"updateUrl",value:function e(t){if(!t||typeof t!=="string"||t.length===0){throw new k.InvalidArgumentException("Url must be a non-empty string!")}this._dataSource.url=t}},{key:"_expandBuffer",value:function e(t){var r=this._stashSize;while(r+1024*1024*1<t){r*=2}r+=1024*1024*1;if(r===this._bufferSize){return}var i=new ArrayBuffer(r);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);var a=new Uint8Array(i,0,r);a.set(n,0)}this._stashBuffer=i;this._bufferSize=r}},{key:"_normalizeSpeed",value:function e(t){var r=this._speedNormalizeList;var i=r.length-1;var n=0;var a=0;var s=i;if(t<r[0]){return r[0]}while(a<=s){n=a+Math.floor((s-a)/2);if(n===i||t>=r[n]&&t<r[n+1]){return r[n]}else if(r[n]<t){a=n+1}else{s=n-1}}}},{key:"_adjustStashSize",value:function e(t){var r=0;if(this._config.isLive){r=t}else{if(t<512){r=t}else if(t>=512&&t<=1024){r=Math.floor(t*1.5)}else{r=t*2}}if(r>8192){r=8192}var i=r*1024+1024*1024*1;if(this._bufferSize<i){this._expandBuffer(i)}this._stashSize=r*1024}},{key:"_dispatchChunks",value:function e(t,r){this._currentRange.to=r+t.byteLength-1;return this._onDataArrival(t,r)}},{key:"_onContentLengthKnown",value:function e(t){if(t&&this._fullRequestFlag){this._totalLength=t;this._fullRequestFlag=false}}},{key:"_onLoaderChunkArrival",value:function e(t,r,i){if(!this._onDataArrival){throw new k.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!")}if(this._isEarlyEofReconnecting){this._isEarlyEofReconnecting=false;if(this._onRecoveredEarlyEof){this._onRecoveredEarlyEof()}}this._speedSampler.addBytes(t.byteLength);var n=this._speedSampler.lastSecondKBps;if(n!==0){var a=this._normalizeSpeed(n);if(this._speedNormalized!==a){this._speedNormalized=a;this._adjustStashSize(a)}}if(!this._enableStash){if(this._stashUsed===0){var s=this._dispatchChunks(t,r);if(s<t.byteLength){var o=t.byteLength-s;if(o>this._bufferSize){this._expandBuffer(o)}var u=new Uint8Array(this._stashBuffer,0,this._bufferSize);u.set(new Uint8Array(t,s),0);this._stashUsed+=o;this._stashByteStart=r+s}}else{if(this._stashUsed+t.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+t.byteLength)}var l=new Uint8Array(this._stashBuffer,0,this._bufferSize);l.set(new Uint8Array(t),this._stashUsed);this._stashUsed+=t.byteLength;var f=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(f<this._stashUsed&&f>0){var d=new Uint8Array(this._stashBuffer,f);l.set(d,0)}this._stashUsed-=f;this._stashByteStart+=f}}else{if(this._stashUsed===0&&this._stashByteStart===0){this._stashByteStart=r}if(this._stashUsed+t.byteLength<=this._stashSize){var h=new Uint8Array(this._stashBuffer,0,this._stashSize);h.set(new Uint8Array(t),this._stashUsed);this._stashUsed+=t.byteLength}else{var c=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var _=this._stashBuffer.slice(0,this._stashUsed);var v=this._dispatchChunks(_,this._stashByteStart);if(v<_.byteLength){if(v>0){var m=new Uint8Array(_,v);c.set(m,0);this._stashUsed=m.byteLength;this._stashByteStart+=v}}else{this._stashUsed=0;this._stashByteStart+=v}if(this._stashUsed+t.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+t.byteLength);c=new Uint8Array(this._stashBuffer,0,this._bufferSize)}c.set(new Uint8Array(t),this._stashUsed);this._stashUsed+=t.byteLength}else{var p=this._dispatchChunks(t,r);if(p<t.byteLength){var g=t.byteLength-p;if(g>this._bufferSize){this._expandBuffer(g);c=new Uint8Array(this._stashBuffer,0,this._bufferSize)}c.set(new Uint8Array(t,p),0);this._stashUsed+=g;this._stashByteStart=r+p}}}}}},{key:"_flushStashBuffer",value:function e(t){if(this._stashUsed>0){var r=this._stashBuffer.slice(0,this._stashUsed);var i=this._dispatchChunks(r,this._stashByteStart);var n=r.byteLength-i;if(i<r.byteLength){if(t){a.default.w(this.TAG,n+" bytes unconsumed data remain when flush buffer, dropped")}else{if(i>0){var s=new Uint8Array(this._stashBuffer,0,this._bufferSize);var o=new Uint8Array(r,i);s.set(o,0);this._stashUsed=o.byteLength;this._stashByteStart+=i}return 0}}this._stashUsed=0;this._stashByteStart=0;return n}return 0}},{key:"_onLoaderComplete",value:function e(t,r){this._flushStashBuffer(true);if(this._onComplete){this._onComplete(this._extraData)}}},{key:"_onLoaderError",value:function e(t,r){a.default.e(this.TAG,"Loader error, code = "+r.code+", msg = "+r.msg);this._flushStashBuffer(false);if(this._isEarlyEofReconnecting){this._isEarlyEofReconnecting=false;t=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF}switch(t){case u.LoaderErrors.EARLY_EOF:{if(!this._config.isLive){if(this._totalLength){var i=this._currentRange.to+1;if(i<this._totalLength){a.default.w(this.TAG,"Connection lost, trying reconnect...");this._isEarlyEofReconnecting=true;this._internalSeek(i,false)}return}}t=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case u.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case u.LoaderErrors.CONNECTING_TIMEOUT:case u.LoaderErrors.HTTP_STATUS_CODE_INVALID:case u.LoaderErrors.EXCEPTION:break}if(this._onError){this._onError(t,r)}else{throw new k.RuntimeException("IOException: "+r.msg)}}},{key:"status",get:function e(){return this._loader.status}},{key:"extraData",get:function e(){return this._extraData},set:function e(t){this._extraData=t}},{key:"onDataArrival",get:function e(){return this._onDataArrival},set:function e(t){this._onDataArrival=t}},{key:"onSeeked",get:function e(){return this._onSeeked},set:function e(t){this._onSeeked=t}},{key:"onError",get:function e(){return this._onError},set:function e(t){this._onError=t}},{key:"onComplete",get:function e(){return this._onComplete},set:function e(t){this._onComplete=t}},{key:"onRecoveredEarlyEof",get:function e(){return this._onRecoveredEarlyEof},set:function e(t){this._onRecoveredEarlyEof=t}},{key:"currentUrl",get:function e(){return this._dataSource.url}},{key:"currentSpeed",get:function e(){if(this._loaderClass===m.default){return this._loader.currentSpeed}return this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function e(){return this._loader.type}}]);return e}();r.default=O},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.BaseLoader=r.LoaderErrors=r.LoaderStatus=undefined;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("../utils/exception.js");function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=r.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};var o=r.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"};var u=r.BaseLoader=function(){function e(t){a(this,e);this._type=t||"undefined";this._status=s.kIdle;this._needStash=false;this._onContentLengthKnown=null;this._onDataArrival=null;this._onError=null;this._onComplete=null}i(e,[{key:"destroy",value:function e(){this._status=s.kIdle;this._onContentLengthKnown=null;this._onDataArrival=null;this._onError=null;this._onComplete=null}},{key:"isWorking",value:function e(){return this._status===s.kConnecting||this._status===s.kBuffering}},{key:"open",value:function e(t,r){throw new n.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function e(){throw new n.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function e(){return this._type}},{key:"status",get:function e(){return this._status}},{key:"needStashBuffer",get:function e(){return this._needStash}},{key:"onContentLengthKnown",get:function e(){return this._onContentLengthKnown},set:function e(t){this._onContentLengthKnown=t}},{key:"onDataArrival",get:function e(){return this._onDataArrival},set:function e(t){this._onDataArrival=t}},{key:"onError",get:function e(){return this._onError},set:function e(t){this._onError=t}},{key:"onComplete",get:function e(){return this._onComplete},set:function e(t){this._onComplete=t}}]);return e}()},{"../utils/exception.js":40}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t,r){n(this,e);this._startName=t;this._endName=r}i(e,[{key:"getConfig",value:function e(t,r){var i=t;if(r.from!==0||r.to!==-1){var n=true;if(i.indexOf("?")===-1){i+="?";n=false}if(n){i+="&"}i+=this._startName+"="+r.from.toString();if(r.to!==-1){i+="&"+this._endName+"="+r.to.toString()}}return{url:i,headers:{}}}}]);return e}();r.default=a},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t){n(this,e);this._zeroStart=t||false}i(e,[{key:"getConfig",value:function e(t,r){var i={};if(r.from!==0||r.to!==-1){var n=void 0;if(r.to!==-1){n="bytes="+r.from.toString()+"-"+r.to.toString()}else{n="bytes="+r.from.toString()+"-"}i["Range"]=n
}else if(this._zeroStart){i["Range"]="bytes=0-"}return{url:t,headers:i}}}]);return e}();r.default=a},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this._firstCheckpoint=0;this._lastCheckpoint=0;this._intervalBytes=0;this._totalBytes=0;this._lastSecondBytes=0;if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance)}else{this._now=Date.now}}i(e,[{key:"reset",value:function e(){this._firstCheckpoint=this._lastCheckpoint=0;this._totalBytes=this._intervalBytes=0;this._lastSecondBytes=0}},{key:"addBytes",value:function e(t){if(this._firstCheckpoint===0){this._firstCheckpoint=this._now();this._lastCheckpoint=this._firstCheckpoint;this._intervalBytes+=t;this._totalBytes+=t}else if(this._now()-this._lastCheckpoint<1e3){this._intervalBytes+=t;this._totalBytes+=t}else{this._lastSecondBytes=this._intervalBytes;this._intervalBytes=t;this._totalBytes+=t;this._lastCheckpoint=this._now()}}},{key:"currentKBps",get:function e(){this.addBytes(0);var t=(this._now()-this._lastCheckpoint)/1e3;if(t==0)t=1;return this._intervalBytes/t/1024}},{key:"lastSecondKBps",get:function e(){this.addBytes(0);if(this._lastSecondBytes!==0){return this._lastSecondBytes/1024}else{if(this._now()-this._lastCheckpoint>=500){return this.currentKBps}else{return 0}}}},{key:"averageKBps",get:function e(){var t=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/t/1024}}]);return e}();r.default=a},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=e("../utils/logger.js");var s=l(a);var o=e("./loader.js");var u=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){h(t,e);n(t,null,[{key:"isSupported",value:function e(){try{return typeof self.WebSocket!=="undefined"}catch(e){return false}}}]);function t(){f(this,t);var e=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"websocket-loader"));e.TAG="WebSocketLoader";e._needStash=true;e._ws=null;e._requestAbort=false;e._receivedLength=0;return e}n(t,[{key:"destroy",value:function e(){if(this._ws){this.abort()}i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t){try{var r=this._ws=new self.WebSocket(t.url);r.binaryType="arraybuffer";r.onopen=this._onWebSocketOpen.bind(this);r.onclose=this._onWebSocketClose.bind(this);r.onmessage=this._onWebSocketMessage.bind(this);r.onerror=this._onWebSocketError.bind(this);this._status=o.LoaderStatus.kConnecting}catch(e){this._status=o.LoaderStatus.kError;var i={code:e.code,msg:e.message};if(this._onError){this._onError(o.LoaderErrors.EXCEPTION,i)}else{throw new u.RuntimeException(i.msg)}}}},{key:"abort",value:function e(){var t=this._ws;if(t&&(t.readyState===0||t.readyState===1)){this._requestAbort=true;t.close()}this._ws=null;this._status=o.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function e(t){this._status=o.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function e(t){if(this._requestAbort===true){this._requestAbort=false;return}this._status=o.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(0,this._receivedLength-1)}}},{key:"_onWebSocketMessage",value:function e(t){var r=this;if(t.data instanceof ArrayBuffer){this._dispatchArrayBuffer(t.data)}else if(t.data instanceof Blob){(function(){var e=new FileReader;e.onload=function(){r._dispatchArrayBuffer(e.result)};e.readAsArrayBuffer(t.data)})()}else{this._status=o.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+t.data.constructor.name};if(this._onError){this._onError(o.LoaderErrors.EXCEPTION,i)}else{throw new u.RuntimeException(i.msg)}}}},{key:"_dispatchArrayBuffer",value:function e(t){var r=t;var i=this._receivedLength;this._receivedLength+=r.byteLength;if(this._onDataArrival){this._onDataArrival(r,i,this._receivedLength)}}},{key:"_onWebSocketError",value:function e(t){this._status=o.LoaderStatus.kError;var r={code:t.code,msg:t.message};if(this._onError){this._onError(o.LoaderErrors.EXCEPTION,r)}else{throw new u.RuntimeException(r.msg)}}}]);return t}(o.BaseLoader);r.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var s=e("../utils/logger.js");var o=f(s);var u=e("./loader.js");var l=e("../utils/exception.js");function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){c(t,e);a(t,null,[{key:"isSupported",value:function e(){try{var t=new XMLHttpRequest;t.open("GET","https://example.com",true);t.responseType="moz-chunked-arraybuffer";return t.responseType==="moz-chunked-arraybuffer"}catch(e){o.default.w("MozChunkedLoader",e.message);return false}}}]);function t(e){d(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-moz-chunked-loader"));r.TAG="MozChunkedLoader";r._seekHandler=e;r._needStash=true;r._xhr=null;r._requestAbort=false;r._contentLength=null;r._receivedLength=0;return r}a(t,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onloadend=null;this._xhr.onerror=null;this._xhr=null}n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){this._dataSource=t;this._range=r;var n=this._seekHandler.getConfig(t.url,r);var a=this._xhr=new XMLHttpRequest;a.open("GET",n.url,true);a.responseType="moz-chunked-arraybuffer";a.onreadystatechange=this._onReadyStateChange.bind(this);a.onprogress=this._onProgress.bind(this);a.onloadend=this._onLoadEnd.bind(this);a.onerror=this._onXhrError.bind(this);if(t.withCredentials&&a["withCredentials"]){a.withCredentials=true}if(i(n.headers)==="object"){var s=n.headers;for(var o in s){if(s.hasOwnProperty(o)){a.setRequestHeader(o,s[o])}}}this._status=u.LoaderStatus.kConnecting;a.send()}},{key:"abort",value:function e(){this._requestAbort=true;if(this._xhr){this._xhr.abort()}this._status=u.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function e(t){var r=t.target;if(r.readyState===2){if(r.status!==0&&(r.status<200||r.status>299)){this._status=u.LoaderStatus.kError;if(this._onError){this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else{throw new l.RuntimeException("MozChunkedLoader: Http code invalid, "+r.status+" "+r.statusText)}}else{this._status=u.LoaderStatus.kBuffering}}}},{key:"_onProgress",value:function e(t){if(this._contentLength===null){if(t.total!==null&&t.total!==0){this._contentLength=t.total;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength)}}}var r=t.target.response;var i=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;if(this._onDataArrival){this._onDataArrival(r,i,this._receivedLength)}}},{key:"_onLoadEnd",value:function e(t){if(this._requestAbort===true){this._requestAbort=false;return}else if(this._status===u.LoaderStatus.kError){return}this._status=u.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1)}}},{key:"_onXhrError",value:function e(t){this._status=u.LoaderStatus.kError;var r=0;var i=null;if(this._contentLength&&t.loaded<this._contentLength){r=u.LoaderErrors.EARLY_EOF;i={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}}else{r=u.LoaderErrors.EXCEPTION;i={code:-1,msg:t.constructor.name+" "+t.type}}if(this._onError){this._onError(r,i)}else{throw new l.RuntimeException(i.msg)}}}]);return t}(u.BaseLoader);r.default=_},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var s=e("../utils/logger.js");var o=f(s);var u=e("./loader.js");var l=e("../utils/exception.js");function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){c(t,e);a(t,null,[{key:"isSupported",value:function e(){try{if(typeof self.MSStream==="undefined"||typeof self.MSStreamReader==="undefined"){return false}var t=new XMLHttpRequest;t.open("GET","https://example.com",true);t.responseType="ms-stream";return t.responseType==="ms-stream"}catch(e){o.default.w("MSStreamLoader",e.message);return false}}}]);function t(e){d(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-msstream-loader"));r.TAG="MSStreamLoader";r._seekHandler=e;r._needStash=true;r._xhr=null;r._reader=null;r._totalRange=null;r._currentRange=null;r._contentLength=null;r._receivedLength=0;r._bufferLimit=16*1024*1024;r._lastTimeBufferSize=0;r._isReconnecting=false;return r}a(t,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}if(this._reader){this._reader.onprogress=null;this._reader.onload=null;this._reader.onerror=null;this._reader=null}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr=null}n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){this._internalOpen(t,r,false)}},{key:"_internalOpen",value:function e(t,r,n){this._dataSource=t;if(!n){this._totalRange=r}else{this._currentRange=r}var a=this._seekHandler.getConfig(t.url,r);var s=this._reader=new self.MSStreamReader;s.onprogress=this._msrOnProgress.bind(this);s.onload=this._msrOnLoad.bind(this);s.onerror=this._msrOnError.bind(this);var o=this._xhr=new XMLHttpRequest;o.open("GET",a.url,true);o.responseType="ms-stream";o.onreadystatechange=this._xhrOnReadyStateChange.bind(this);o.onerror=this._xhrOnError.bind(this);if(t.withCredentials){o.withCredentials=true}if(i(a.headers)==="object"){var l=a.headers;for(var f in l){if(l.hasOwnProperty(f)){o.setRequestHeader(f,l[f])}}}if(this._isReconnecting){this._isReconnecting=false}else{this._status=u.LoaderStatus.kConnecting}o.send()}},{key:"abort",value:function e(){this._internalAbort();this._status=u.LoaderStatus.kComplete}},{key:"_internalAbort",value:function e(){if(this._reader){if(this._reader.readyState===1){this._reader.abort()}this._reader.onprogress=null;this._reader.onload=null;this._reader.onerror=null;this._reader=null}if(this._xhr){this._xhr.abort();this._xhr.onreadystatechange=null;this._xhr=null}}},{key:"_xhrOnReadyStateChange",value:function e(t){var r=t.target;if(r.readyState===3){if(r.status>=200&&r.status<=299){this._status=u.LoaderStatus.kBuffering;var i=r.getResponseHeader("Content-Length");if(i!=null&&this._contentLength==null){var n=parseInt(i);if(n>0){this._contentLength=n;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength)}}}var a=r.response;this._reader.readAsArrayBuffer(a)}else{this._status=u.LoaderStatus.kError;if(this._onError){this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else{throw new l.RuntimeException("MSStreamLoader: Http code invalid, "+r.status+" "+r.statusText)}}}}},{key:"_xhrOnError",value:function e(t){this._status=u.LoaderStatus.kError;var r=u.LoaderErrors.EXCEPTION;var i={code:-1,msg:t.constructor.name+" "+t.type};if(this._onError){this._onError(r,i)}else{throw new l.RuntimeException(i.msg)}}},{key:"_msrOnProgress",value:function e(t){var r=t.target;var i=r.result;if(i==null){this._doReconnectIfNeeded();return}var n=i.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=i.byteLength;var a=this._totalRange.from+this._receivedLength;this._receivedLength+=n.byteLength;if(this._onDataArrival){this._onDataArrival(n,a,this._receivedLength)}if(i.byteLength>=this._bufferLimit){o.default.v(this.TAG,"MSStream buffer exceeded max size near "+(a+n.byteLength)+", reconnecting...");this._doReconnectIfNeeded()}}},{key:"_doReconnectIfNeeded",value:function e(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=true;this._lastTimeBufferSize=0;this._internalAbort();var t={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,t,true)}}},{key:"_msrOnLoad",value:function e(t){this._status=u.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}}},{key:"_msrOnError",value:function e(t){this._status=u.LoaderStatus.kError;var r=0;var i=null;if(this._contentLength&&this._receivedLength<this._contentLength){r=u.LoaderErrors.EARLY_EOF;i={code:-1,msg:"MSStream meet Early-Eof"}}else{r=u.LoaderErrors.EARLY_EOF;i={code:-1,msg:t.constructor.name+" "+t.type}}if(this._onError){this._onError(r,i)}else{throw new l.RuntimeException(i.msg)}}}]);return t}(u.BaseLoader);r.default=_},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function e(t,r,i){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,r);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,r,i)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(i)}};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var s=e("../utils/logger.js");var o=h(s);var u=e("./speed-sampler.js");var l=h(u);var f=e("./loader.js");var d=e("../utils/exception.js");function h(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){v(t,e);a(t,null,[{key:"isSupported",value:function e(){try{var t=new XMLHttpRequest;t.open("GET","https://example.com",true);t.responseType="arraybuffer";return t.responseType==="arraybuffer"}catch(e){o.default.w("RangeLoader",e.message);return false}}}]);function t(e){c(this,t);var r=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-range-loader"));r.TAG="RangeLoader";r._seekHandler=e;r._needStash=false;r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192];r._currentChunkSizeKB=384;r._currentSpeedNormalized=0;r._zeroSpeedChunkCount=0;r._xhr=null;r._speedSampler=new l.default;r._requestAbort=false;r._waitForTotalLength=false;r._totalLengthReceived=false;r._currentRequestRange=null;r._totalLength=null;r._contentLength=null;r._receivedLength=0;r._lastTimeLoaded=0;return r}a(t,[{key:"destroy",value:function e(){if(this.isWorking()){this.abort()}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr=null}n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function e(t,r){this._dataSource=t;this._range=r;this._status=f.LoaderStatus.kConnecting;if(!this._totalLengthReceived){this._waitForTotalLength=true;this._internalOpen(this._dataSource,{from:0,to:-1})}else{this._openSubRange()}}},{key:"_openSubRange",value:function e(){var t=this._currentChunkSizeKB*1024;var r=this._range.from+this._receivedLength;var i=r+t;if(this._contentLength!=null){if(i-this._range.from>=this._contentLength){i=this._range.from+this._contentLength-1}}this._currentRequestRange={from:r,to:i};this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function e(t,r){this._lastTimeLoaded=0;var n=this._seekHandler.getConfig(t.url,r);var a=this._xhr=new XMLHttpRequest;a.open("GET",n.url,true);a.responseType="arraybuffer";a.onreadystatechange=this._onReadyStateChange.bind(this);a.onprogress=this._onProgress.bind(this);a.onload=this._onLoad.bind(this);a.onerror=this._onXhrError.bind(this);if(t.withCredentials&&a["withCredentials"]){a.withCredentials=true}if(i(n.headers)==="object"){var s=n.headers;for(var o in s){if(s.hasOwnProperty(o)){a.setRequestHeader(o,s[o])}}}a.send()}},{key:"abort",value:function e(){this._requestAbort=true;this._internalAbort();this._status=f.LoaderStatus.kComplete}},{key:"_internalAbort",value:function e(){if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr.abort();this._xhr=null}}},{key:"_onReadyStateChange",value:function e(t){var r=t.target;if(r.readyState===2){if(r.status>=200&&r.status<300){if(this._waitForTotalLength){return}this._status=f.LoaderStatus.kBuffering}else{this._status=f.LoaderStatus.kError;if(this._onError){this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else{throw new d.RuntimeException("RangeLoader: Http code invalid, "+r.status+" "+r.statusText)}}}}},{key:"_onProgress",value:function e(t){if(this._contentLength===null){var r=false;if(this._waitForTotalLength){this._waitForTotalLength=false;this._totalLengthReceived=true;r=true;var i=t.total;this._internalAbort();if(i!=null&i!==0){this._totalLength=i}}if(this._range.to===-1){this._contentLength=this._totalLength-this._range.from}else{this._contentLength=this._range.to-this._range.from+1}if(r){this._openSubRange();return}if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength)}}var n=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded;this._speedSampler.addBytes(n)}},{key:"_normalizeSpeed",value:function e(t){var r=this._chunkSizeKBList;var i=r.length-1;var n=0;var a=0;var s=i;if(t<r[0]){return r[0]}while(a<=s){n=a+Math.floor((s-a)/2);if(n===i||t>=r[n]&&t<r[n+1]){return r[n]}else if(r[n]<t){a=n+1}else{s=n-1}}}},{key:"_onLoad",value:function e(t){if(this._waitForTotalLength){this._waitForTotalLength=false;return}this._lastTimeLoaded=0;var r=this._speedSampler.lastSecondKBps;if(r===0){this._zeroSpeedChunkCount++;if(this._zeroSpeedChunkCount>=3){r=this._speedSampler.currentKBps}}if(r!==0){var i=this._normalizeSpeed(r);if(this._currentSpeedNormalized!==i){this._currentSpeedNormalized=i;this._currentChunkSizeKB=i}}var n=t.target.response;var a=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var s=false;if(this._contentLength!=null&&this._receivedLength<this._contentLength){this._openSubRange()}else{s=true}if(this._onDataArrival){this._onDataArrival(n,a,this._receivedLength)}if(s){this._status=f.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1)}}}},{key:"_onXhrError",value:function e(t){this._status=f.LoaderStatus.kError;var r=0;var i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength){r=f.LoaderErrors.EARLY_EOF;i={code:-1,msg:"RangeLoader meet Early-Eof"}}else{r=f.LoaderErrors.EXCEPTION;i={code:-1,msg:t.constructor.name+" "+t.type}}if(this._onError){this._onError(r,i)}else{throw new d.RuntimeException(i.msg)}}},{key:"currentSpeed",get:function e(){return this._speedSampler.lastSecondKBps}}]);return t}(f.BaseLoader);r.default=m},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=e("events");var s=w(a);var o=e("../utils/logger.js");var u=w(o);var l=e("../utils/browser.js");var f=w(l);var d=e("./player-events.js");var h=w(d);var c=e("../core/transmuxer.js");var _=w(c);var v=e("../core/transmuxing-events.js");var m=w(v);var p=e("../core/mse-controller.js");var g=w(p);var y=e("../core/mse-events.js");var E=w(y);var b=e("./player-errors.js");var S=e("../config.js");var k=e("../utils/exception.js");function w(e){return e&&e.__esModule?e:{default:e}}function L(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var O=function(){function e(t,r){L(this,e);this.TAG="FlvPlayer";this._type="FlvPlayer";this._emitter=new s.default;this._config=(0,S.createDefaultConfig)();if((typeof r==="undefined"?"undefined":i(r))==="object"){Object.assign(this._config,r)}if(t.type.toLowerCase()!=="flv"){throw new k.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!")}if(t.isLive===true){this._config.isLive=true}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)};if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance)}else{this._now=Date.now}this._pendingSeekTime=null;this._requestSetTime=false;this._seekpointRecord=null;this._progressChecker=null;this._mediaDataSource=t;this._mediaElement=null;this._msectl=null;this._transmuxer=null;this._mseSourceOpened=false;this._hasPendingLoad=false;this._receivedCanPlay=false;this._mediaInfo=null;this._statisticsInfo=null;var n=f.default.chrome&&(f.default.version.major<50||f.default.version.major===50&&f.default.version.build<2661);this._alwaysSeekKeyframe=n||f.default.msedge||f.default.msie?true:false;if(this._alwaysSeekKeyframe){this._config.accurateSeek=false}}n(e,[{key:"destroy",value:function e(){if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null}if(this._transmuxer){this.unload()}if(this._mediaElement){this.detachMediaElement()}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){var i=this;if(t===h.default.MEDIA_INFO){if(this._mediaInfo!=null){Promise.resolve().then(function(){i._emitter.emit(h.default.MEDIA_INFO,i.mediaInfo)})}}else if(t===h.default.STATISTICS_INFO){if(this._statisticsInfo!=null){Promise.resolve().then(function(){i._emitter.emit(h.default.STATISTICS_INFO,i.statisticsInfo)})}}this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"attachMediaElement",value:function e(t){var r=this;this._mediaElement=t;t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata);t.addEventListener("seeking",this.e.onvSeeking);t.addEventListener("canplay",this.e.onvCanPlay);t.addEventListener("stalled",this.e.onvStalled);t.addEventListener("progress",this.e.onvProgress);this._msectl=new g.default;this._msectl.on(E.default.UPDATE_END,this._onmseUpdateEnd.bind(this));this._msectl.on(E.default.BUFFER_FULL,this._onmseBufferFull.bind(this));this._msectl.on(E.default.SOURCE_OPEN,function(){r._mseSourceOpened=true;if(r._hasPendingLoad){r._hasPendingLoad=false;r.load()}});this._msectl.on(E.default.ERROR,function(e){r._emitter.emit(h.default.ERROR,b.ErrorTypes.MEDIA_ERROR,b.ErrorDetails.MEDIA_MSE_ERROR,e)});this._msectl.attachMediaElement(t);if(this._pendingSeekTime!=null){try{t.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}catch(e){}}}},{key:"detachMediaElement",value:function e(){if(this._mediaElement){this._msectl.detachMediaElement();this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata);this._mediaElement.removeEventListener("seeking",this.e.onvSeeking);this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay);this._mediaElement.removeEventListener("stalled",this.e.onvStalled);this._mediaElement.removeEventListener("progress",this.e.onvProgress);this._mediaElement=null}if(this._msectl){this._msectl.destroy();this._msectl=null}}},{key:"load",value:function e(){var t=this;if(!this._mediaElement){throw new k.IllegalStateException("HTMLMediaElement must be attached before load()!")}if(this._transmuxer){throw new k.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!")}if(this._hasPendingLoad){return}if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===false){this._hasPendingLoad=true;return}if(this._mediaElement.readyState>0){this._requestSetTime=true;this._mediaElement.currentTime=0}this._transmuxer=new _.default(this._mediaDataSource,this._config);this._transmuxer.on(m.default.INIT_SEGMENT,function(e,r){t._msectl.appendInitSegment(r)});this._transmuxer.on(m.default.MEDIA_SEGMENT,function(e,r){t._msectl.appendMediaSegment(r);t._msectl.update(t._config.isLive);if(t._config.lazyLoad&&!t._config.isLive){var i=t._mediaElement.currentTime;if(r.info.endDts>=(i+t._config.lazyLoadMaxDuration)*1e3){if(t._progressChecker==null){}}}});this._transmuxer.on(m.default.LOADING_COMPLETE,function(){t._msectl.endOfStream();t._emitter.emit(h.default.LOADING_COMPLETE)});this._transmuxer.on(m.default.RECOVERED_EARLY_EOF,function(){t._emitter.emit(h.default.RECOVERED_EARLY_EOF)});this._transmuxer.on(m.default.IO_ERROR,function(e,r){t._emitter.emit(h.default.ERROR,b.ErrorTypes.NETWORK_ERROR,e,r)});this._transmuxer.on(m.default.DEMUX_ERROR,function(e,r){t._emitter.emit(h.default.ERROR,b.ErrorTypes.MEDIA_ERROR,e,{code:-1,msg:r})});this._transmuxer.on(m.default.MEDIA_INFO,function(e){t._mediaInfo=e;t._emitter.emit(h.default.MEDIA_INFO,Object.assign({},e))});this._transmuxer.on(m.default.STATISTICS_INFO,function(e){t._statisticsInfo=t._fillStatisticsInfo(e);t._emitter.emit(h.default.STATISTICS_INFO,Object.assign({},t._statisticsInfo))});this._transmuxer.on(m.default.RECOMMEND_SEEKPOINT,function(e){if(t._mediaElement&&!t._config.accurateSeek){t._requestSetTime=true;t._mediaElement.currentTime=e/1e3}});this._transmuxer.open()}},{key:"unload",value:function e(){if(this._mediaElement){this._mediaElement.pause()}if(this._msectl){this._msectl.seek(0)}if(this._transmuxer){this._transmuxer.close();this._transmuxer.destroy();this._transmuxer=null}}},{key:"play",value:function e(){this._mediaElement.play()}},{key:"changestream",value:function e(t){var r=this._mediaDataSource.url;var i;if(t){if(r.indexOf("st=")>0)i=r.replace("st=0","st=1");else i=r+"&st=1"}else{if(r.indexOf("st=")>0)i=r.replace("st=1","st=0");else i=r+"&st=0"}this.unload();this._mediaDataSource.url=i;this._mediaDataSource.segments[0].url=i;this.load();this.play()}},{key:"seek",value:function e(t){var r=this._mediaDataSource.url;var i;if(t){var n=r.indexOf("starttime=");if(n>0){var a=r.substr(n,24);i=r.replace(a,"starttime="+t)}}this.unload();this._mediaDataSource.url=i;this._mediaDataSource.segments[0].url=i;this.load();this.play()}},{key:"pause",value:function e(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function e(t){t.playerType=this._type;if(!(this._mediaElement instanceof HTMLVideoElement)){return t}var r=true;var i=0;var n=0;if(this._mediaElement.getVideoPlaybackQuality){var a=this._mediaElement.getVideoPlaybackQuality();i=a.totalVideoFrames;n=a.droppedVideoFrames}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){i=this._mediaElement.webkitDecodedFrameCount;n=this._mediaElement.webkitDroppedFrameCount}else{r=false}if(r){t.decodedFrames=i;t.droppedFrames=n}return t}},{
key:"_onmseUpdateEnd",value:function e(){if(!this._config.lazyLoad||this._config.isLive){return}var t=this._mediaElement.buffered;var r=this._mediaElement.currentTime;var i=0;var n=0;for(var a=0;a<t.length;a++){var s=t.start(a);var o=t.end(a);if(s<=r&&r<o){i=s;n=o;break}}if(n>=r+this._config.lazyLoadMaxDuration&&this._progressChecker==null){u.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task");this._suspendTransmuxer()}}},{key:"_onmseBufferFull",value:function e(){u.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task");if(this._progressChecker==null){this._suspendTransmuxer()}}},{key:"_suspendTransmuxer",value:function e(){if(this._transmuxer){this._transmuxer.pause();if(this._progressChecker==null){this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)}}}},{key:"_checkProgressAndResume",value:function e(){var t=this._mediaElement.currentTime;var r=this._mediaElement.buffered;var i=0;for(var n=0;n<r.length;n++){var a=r.start(n);var s=r.end(n);if(t>=a){if(t>=s-this._config.lazyLoadRecoverDuration){i=s}break}}if(i){window.clearInterval(this._progressChecker);this._progressChecker=null;if(i){u.default.v(this.TAG,"Continue loading from paused position");this._transmuxer.resume(i*1e3)}}}},{key:"_isTimepointBuffered",value:function e(t){var r=this._mediaElement.buffered;for(var i=0;i<r.length;i++){var n=r.start(i);var a=r.end(i);if(t>=n&&t<a){return true}}return false}},{key:"_internalSeek",value:function e(t){var r=this._isTimepointBuffered(t);var i=false;var n=0;if(t<1&&this._mediaElement.buffered.length>0){var a=this._mediaElement.buffered.start(0);if(a<1&&t<a||f.default.safari){i=true;n=f.default.safari?.1:a}}if(i){this._requestSetTime=true;this._mediaElement.currentTime=n}else if(r){if(!this._alwaysSeekKeyframe){this._requestSetTime=true;this._mediaElement.currentTime=t}else{var s=this._msectl.getNearestKeyframe(Math.floor(t*1e3));this._requestSetTime=true;if(s!=null){this._mediaElement.currentTime=s.dts/1e3}else{this._mediaElement.currentTime=t}}if(this._progressChecker!=null){this._checkProgressAndResume()}}else{if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null}this._msectl.seek(t);this._transmuxer.seek(Math.floor(t*1e3));if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=t}}}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function e(){if(this._seekpointRecord){if(this._seekpointRecord.recordTime<=this._now()-100){var t=this._mediaElement.currentTime;this._seekpointRecord=null;if(!this._isTimepointBuffered(t)){if(this._progressChecker!=null){window.clearTimeout(this._progressChecker);this._progressChecker=null}this._msectl.seek(t);this._transmuxer.seek(Math.floor(t*1e3));if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=t}}}else{window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}}}},{key:"_checkAndResumeStuckPlayback",value:function e(t){var r=this._mediaElement;if(t||!this._receivedCanPlay||r.readyState<2){var i=r.buffered;if(i.length>0&&r.currentTime<i.start(0)){u.default.w(this.TAG,"Playback seems stuck at "+r.currentTime+", seek to "+i.start(0));this._requestSetTime=true;this._mediaElement.currentTime=i.start(0);this._mediaElement.removeEventListener("progress",this.e.onvProgress)}}else{this._mediaElement.removeEventListener("progress",this.e.onvProgress)}}},{key:"_onvLoadedMetadata",value:function e(t){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}}},{key:"_onvSeeking",value:function e(t){var r=this._mediaElement.currentTime;var i=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=false;return}if(r<1&&i.length>0){var n=i.start(0);if(n<1&&r<n||f.default.safari){this._requestSetTime=true;this._mediaElement.currentTime=f.default.safari?.1:n;return}}if(this._isTimepointBuffered(r)){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(r*1e3));if(a!=null){this._requestSetTime=true;this._mediaElement.currentTime=a.dts/1e3}}if(this._progressChecker!=null){this._checkProgressAndResume()}return}this._seekpointRecord={seekPoint:r,recordTime:this._now()};window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_onvCanPlay",value:function e(t){this._receivedCanPlay=true;this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function e(t){this._checkAndResumeStuckPlayback(true)}},{key:"_onvProgress",value:function e(t){this._checkAndResumeStuckPlayback()}},{key:"type",get:function e(){return this._type}},{key:"buffered",get:function e(){return this._mediaElement.buffered}},{key:"duration",get:function e(){return this._mediaElement.duration}},{key:"volume",get:function e(){return this._mediaElement.volume},set:function e(t){this._mediaElement.volume=t}},{key:"muted",get:function e(){return this._mediaElement.muted},set:function e(t){this._mediaElement.muted=t}},{key:"currentTime",get:function e(){if(this._mediaElement){return this._mediaElement.currentTime}return 0},set:function e(t){if(this._mediaElement){this._internalSeek(t)}else{this._pendingSeekTime=t}}},{key:"mediaInfo",get:function e(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function e(){if(this._statisticsInfo==null){this._statisticsInfo={}}this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo);return Object.assign({},this._statisticsInfo)}}]);return e}();r.default=O},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=e("events");var s=d(a);var o=e("./player-events.js");var u=d(o);var l=e("../config.js");var f=e("../utils/exception.js");function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(t,r){h(this,e);this.TAG="NativePlayer";this._type="NativePlayer";this._emitter=new s.default;this._config=(0,l.createDefaultConfig)();if((typeof r==="undefined"?"undefined":i(r))==="object"){Object.assign(this._config,r)}if(t.type.toLowerCase()==="flv"){throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!")}if(t.hasOwnProperty("segments")){throw new f.InvalidArgumentException("NativePlayer("+t.type+") doesn't support multipart playback!")}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)};this._pendingSeekTime=null;this._statisticsReporter=null;this._mediaDataSource=t;this._mediaElement=null}n(e,[{key:"destroy",value:function e(){if(this._mediaElement){this.unload();this.detachMediaElement()}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null}},{key:"on",value:function e(t,r){var i=this;if(t===u.default.MEDIA_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){Promise.resolve().then(function(){i._emitter.emit(u.default.MEDIA_INFO,i.mediaInfo)})}}else if(t===u.default.STATISTICS_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){Promise.resolve().then(function(){i._emitter.emit(u.default.STATISTICS_INFO,i.statisticsInfo)})}}this._emitter.addListener(t,r)}},{key:"off",value:function e(t,r){this._emitter.removeListener(t,r)}},{key:"attachMediaElement",value:function e(t){this._mediaElement=t;t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata);if(this._pendingSeekTime!=null){try{t.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}catch(e){}}}},{key:"detachMediaElement",value:function e(){if(this._mediaElement){this._mediaElement.src="";this._mediaElement.removeAttribute("src");this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata);this._mediaElement=null}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null}}},{key:"load",value:function e(){if(!this._mediaElement){throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!")}this._mediaElement.src=this._mediaDataSource.url;if(this._mediaElement.readyState>0){this._mediaElement.currentTime=0}this._mediaElement.preload="auto";this._mediaElement.load();this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function e(){if(this._mediaElement){this._mediaElement.src="";this._mediaElement.removeAttribute("src")}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null}}},{key:"play",value:function e(){this._mediaElement.play()}},{key:"pause",value:function e(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function e(t){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null}this._emitter.emit(u.default.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function e(){this._emitter.emit(u.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function e(){return this._type}},{key:"buffered",get:function e(){return this._mediaElement.buffered}},{key:"duration",get:function e(){return this._mediaElement.duration}},{key:"volume",get:function e(){return this._mediaElement.volume},set:function e(t){this._mediaElement.volume=t}},{key:"muted",get:function e(){return this._mediaElement.muted},set:function e(t){this._mediaElement.muted=t}},{key:"currentTime",get:function e(){if(this._mediaElement){return this._mediaElement.currentTime}return 0},set:function e(t){if(this._mediaElement){this._mediaElement.currentTime=t}else{this._pendingSeekTime=t}}},{key:"mediaInfo",get:function e(){var t=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/";var r={mimeType:t+this._mediaDataSource.type};if(this._mediaElement){r.duration=Math.floor(this._mediaElement.duration*1e3);if(this._mediaElement instanceof HTMLVideoElement){r.width=this._mediaElement.videoWidth;r.height=this._mediaElement.videoHeight}}return r}},{key:"statisticsInfo",get:function e(){var t={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement)){return t}var r=true;var i=0;var n=0;if(this._mediaElement.getVideoPlaybackQuality){var a=this._mediaElement.getVideoPlaybackQuality();i=a.totalVideoFrames;n=a.droppedVideoFrames}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){i=this._mediaElement.webkitDecodedFrameCount;n=this._mediaElement.webkitDroppedFrameCount}else{r=false}if(r){t.decodedFrames=i;t.droppedFrames=n}return t}}]);return e}();r.default=c},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.ErrorDetails=r.ErrorTypes=undefined;var i=e("../io/loader.js");var n=e("../demux/demux-errors.js");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}var o=r.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"};var u=r.ErrorDetails={NETWORK_EXCEPTION:i.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:i.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:i.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:i.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.default.CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",STATISTICS_INFO:"statistics_info"};r.default=i},{}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e)}i(e,null,[{key:"getSilentFrame",value:function e(t){if(t===1){return new Uint8Array([0,200,0,128,35,128])}else if(t===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(t===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(t===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(t===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(t===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}return null}}]);return e}();r.default=a},{}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e)}i(e,null,[{key:"init",value:function t(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var r in e.types){if(e.types.hasOwnProperty(r)){e.types[r]=[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]}}var i=e.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]);i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]);i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]);i.STSC=i.STCO=i.STTS;i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function e(t){var r=8;var i=null;var n=Array.prototype.slice.call(arguments,1);var a=n.length;for(var s=0;s<a;s++){r+=n[s].byteLength}i=new Uint8Array(r);i[0]=r>>>24&255;i[1]=r>>>16&255;i[2]=r>>>8&255;i[3]=r&255;i.set(t,4);var o=8;for(var u=0;u<a;u++){i.set(n[u],o);o+=n[u].byteLength}return i}},{key:"generateInitSegment",value:function t(r){var i=e.box(e.types.ftyp,e.constants.FTYP);var n=e.moov(r);var a=new Uint8Array(i.byteLength+n.byteLength);a.set(i,0);a.set(n,i.byteLength);return a}},{key:"moov",value:function t(r){var i=e.mvhd(r.timescale,r.duration);var n=e.trak(r);var a=e.mvex(r);return e.box(e.types.moov,i,n,a)}},{key:"mvhd",value:function t(r,i){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function t(r){return e.box(e.types.trak,e.tkhd(r),e.mdia(r))}},{key:"tkhd",value:function t(r){var i=r.id,n=r.duration;var a=r.presentWidth,s=r.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,n&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>>8&255,a&255,0,0,s>>>8&255,s&255,0,0]))}},{key:"mdia",value:function t(r){return e.box(e.types.mdia,e.mdhd(r),e.hdlr(r),e.minf(r))}},{key:"mdhd",value:function t(r){var i=r.timescale;var n=r.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,85,196,0,0]))}},{key:"hdlr",value:function t(r){var i=null;if(r.type==="audio"){i=e.constants.HDLR_AUDIO}else{i=e.constants.HDLR_VIDEO}return e.box(e.types.hdlr,i)}},{key:"minf",value:function t(r){var i=null;if(r.type==="audio"){i=e.box(e.types.smhd,e.constants.SMHD)}else{i=e.box(e.types.vmhd,e.constants.VMHD)}return e.box(e.types.minf,i,e.dinf(),e.stbl(r))}},{key:"dinf",value:function t(){var r=e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF));return r}},{key:"stbl",value:function t(r){var i=e.box(e.types.stbl,e.stsd(r),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO));return i}},{key:"stsd",value:function t(r){if(r.type==="audio"){return e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(r))}else{return e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(r))}}},{key:"mp4a",value:function t(r){var i=r.channelCount;var n=r.audioSampleRate;var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,n&255,0,0]);return e.box(e.types.mp4a,a,e.esds(r))}},{key:"esds",value:function t(r){var i=r.config;var n=i.length;var a=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(i).concat([6,1,2]));return e.box(e.types.esds,a)}},{key:"avc1",value:function t(r){var i=r.avcc;var n=r.codecWidth,a=r.codecHeight;var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,n&255,a>>>8&255,a&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,s,e.box(e.types.avcC,i))}},{key:"mvex",value:function t(r){return e.box(e.types.mvex,e.trex(r))}},{key:"trex",value:function t(r){var i=r.id;var n=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)}},{key:"moof",value:function t(r,i){return e.box(e.types.moof,e.mfhd(r.sequenceNumber),e.traf(r,i))}},{key:"mfhd",value:function t(r){var i=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255]);return e.box(e.types.mfhd,i)}},{key:"traf",value:function t(r,i){var n=r.id;var a=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,n&255]));var s=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255]));var o=e.sdtp(r);var u=e.trun(r,o.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,a,s,u,o)}},{key:"sdtp",value:function t(r){var i=r.samples||[];var n=i.length;var a=new Uint8Array(4+n);for(var s=0;s<n;s++){var o=i[s].flags;a[s+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return e.box(e.types.sdtp,a)}},{key:"trun",value:function t(r,i){var n=r.samples||[];var a=n.length;var s=12+16*a;var o=new Uint8Array(s);i+=8+s;o.set([0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,a&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0);for(var u=0;u<a;u++){var l=n[u].duration;var f=n[u].size;var d=n[u].flags;var h=n[u].cts;o.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*u)}return e.box(e.types.trun,o)}},{key:"mdat",value:function t(r){return e.box(e.types.mdat,r)}}]);return e}();a.init();r.default=a},{}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("../utils/logger.js");var a=_(n);var s=e("./mp4-generator.js");var o=_(s);var u=e("./aac-silent.js");var l=_(u);var f=e("../utils/browser.js");var d=_(f);var h=e("../core/media-segment-info.js");var c=e("../utils/exception.js");function _(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var m=function(){function e(t){v(this,e);this.TAG="MP4Remuxer";this._config=t;this._isLive=t.isLive===true?true:false;this._dtsBase=-1;this._dtsBaseInited=false;this._audioDtsBase=Infinity;this._videoDtsBase=Infinity;this._audioNextDts=undefined;this._videoNextDts=undefined;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList=new h.MediaSegmentInfoList("audio");this._videoSegmentInfoList=new h.MediaSegmentInfoList("video");this._onInitSegment=null;this._onMediaSegment=null;this._forceFirstIDR=d.default.chrome&&(d.default.version.major<50||d.default.version.major===50&&d.default.version.build<2661)?true:false;this._fillSilentAfterSeek=d.default.msedge||d.default.msie}i(e,[{key:"destroy",value:function e(){this._dtsBase=-1;this._dtsBaseInited=false;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList.clear();this._audioSegmentInfoList=null;this._videoSegmentInfoList.clear();this._videoSegmentInfoList=null;this._onInitSegment=null;this._onMediaSegment=null}},{key:"bindDataSource",value:function e(t){t.onDataAvailable=this.remux.bind(this);t.onTrackMetadata=this._onTrackMetadataReceived.bind(this);return this}},{key:"insertDiscontinuity",value:function e(){this._audioNextDts=this._videoNextDts=undefined}},{key:"seek",value:function e(t){this._videoSegmentInfoList.clear();this._audioSegmentInfoList.clear()}},{key:"remux",value:function e(t,r){if(!this._onMediaSegment){throw new c.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!")}if(!this._dtsBaseInited){this._calculateDtsBase(t,r)}this._remuxVideo(r);this._remuxAudio(t)}},{key:"_onTrackMetadataReceived",value:function e(t,r){var i=null;if(t==="audio"){this._audioMeta=r;i=o.default.generateInitSegment(r)}else if(t==="video"){this._videoMeta=r;i=o.default.generateInitSegment(r)}else{return}if(!this._onInitSegment){throw new c.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!")}this._onInitSegment(t,{type:t,data:i.buffer,codec:r.codec,container:t+"/mp4"})}},{key:"_calculateDtsBase",value:function e(t,r){if(this._dtsBaseInited){return}if(t.samples&&t.samples.length){this._audioDtsBase=t.samples[0].dts}if(r.samples&&r.samples.length){this._videoDtsBase=r.samples[0].dts}this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase);this._dtsBaseInited=true}},{key:"_remuxAudio",value:function e(t){var r=t;var i=r.samples;var n=undefined;var a=-1,s=-1,u=-1;if(i.length<2)return;var l=false;var f=-1;if(!i||i.length===0){return}var d=8+r.length;var c=new Uint8Array(d);c[0]=d>>>24&255;c[1]=d>>>16&255;c[2]=d>>>8&255;c[3]=d&255;c.set(o.default.types.mdat,4);var _=8;var v=[];while(i.length){var m=i.shift();var p=m.unit;var g=m.dts-this._dtsBase;if(n==undefined){if(this._audioNextDts==undefined){if(this._audioSegmentInfoList.isEmpty()){n=0;if(this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()){l=true}}else{var y=this._audioSegmentInfoList.getLastSampleBefore(g);if(y!=null){var E=g-(y.originalDts+y.duration);if(E<=3){E=0}var b=y.dts+y.duration+E;n=g-b}else{n=0}}}else{n=g-this._audioNextDts}}var S=g-n;if(l){var k=this._videoSegmentInfoList.getLastSegmentBefore(g);if(k!=null&&k.beginDts<S){f=S-k.beginDts;S=k.beginDts}else{l=false}}if(a===-1){a=S}if(l){l=false;i.unshift(m);var w=this._generateSilentAudio(S,f);if(w==null){continue}var L=w.mp4Sample;var O=w.unit;v.push(L);d+=O.byteLength;c=new Uint8Array(d);c[0]=d>>>24&255;c[1]=d>>>16&255;c[2]=d>>>8&255;c[3]=d&255;c.set(o.default.types.mdat,4);c.set(O,_);_+=O.byteLength;continue}var T=0;if(i.length>=1){var A=i[0].dts-this._dtsBase-n;T=A-S}else{if(v.length>=1){T=v[v.length-1].duration}else{T=this._audioMeta.refSampleDuration}}var R={dts:S,pts:S,cts:0,size:p.byteLength,duration:T,originalDts:g,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};v.push(R);c.set(p,_);_+=p.byteLength}var I=v[v.length-1];s=I.dts+I.duration;this._audioNextDts=s;var C=new h.MediaSegmentInfo;C.beginDts=a;C.endDts=s;C.beginPts=a;C.endPts=s;C.originalBeginDts=v[0].originalDts;C.originalEndDts=I.originalDts+I.duration;C.firstSample=new h.SampleInfo(v[0].dts,v[0].pts,v[0].duration,v[0].originalDts,false);C.lastSample=new h.SampleInfo(I.dts,I.pts,I.duration,I.originalDts,false);if(!this._isLive){this._audioSegmentInfoList.append(C)}r.samples=v;r.sequenceNumber++;var x=o.default.moof(r,a);r.samples=[];r.length=0;this._onMediaSegment("audio",{type:"audio",data:this._mergeBoxes(x,c).buffer,sampleCount:v.length,info:C})}},{key:"_generateSilentAudio",value:function e(t,r){a.default.v(this.TAG,"GenerateSilentAudio: dts = "+t+", duration = "+r);var i=l.default.getSilentFrame(this._audioMeta.channelCount);if(i==null){a.default.w(this.TAG,"Cannot generate silent aac frame for channelCount = "+this._audioMeta.channelCount);return null}var n={dts:t,pts:t,cts:0,size:i.byteLength,duration:r,originalDts:t,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};return{unit:i,mp4Sample:n}}},{key:"_remuxVideo",value:function e(t){var r=t;var i=r.samples;var n=undefined;var a=-1,s=-1;var u=-1,l=-1;if(!i||i.length===0){return}if(i.length<2)return;var f=8+t.length;var d=new Uint8Array(f);d[0]=f>>>24&255;d[1]=f>>>16&255;d[2]=f>>>8&255;d[3]=f&255;d.set(o.default.types.mdat,4);var c=8;var _=[];var v=new h.MediaSegmentInfo;while(i.length>1){var m=i.shift();var p=m.isKeyframe;var g=m.dts-this._dtsBase;if(n==undefined){if(this._videoNextDts==undefined){if(this._videoSegmentInfoList.isEmpty()){n=0}else{var y=this._videoSegmentInfoList.getLastSampleBefore(g);if(y!=null){var E=g-(y.originalDts+y.duration);if(E<=3){E=0}var b=y.dts+y.duration+E;n=g-b}else{n=0}}}else{n=g-this._videoNextDts}}var S=g-n;var k=m.cts;var w=S+k;if(a===-1){a=S;u=w}var L=0;while(m.units.length){var O=m.units.shift();var T=O.data;d.set(T,c);c+=T.byteLength;L+=T.byteLength}var A=0;if(i.length>=1){var R=i[0].dts-this._dtsBase-n;A=R-S}else{if(_.length>=1){A=_[_.length-1].duration}else{A=this._videoMeta.refSampleDuration}}if(p){var I=new h.SampleInfo(S,w,A,m.dts,true);I.fileposition=m.fileposition;v.appendSyncPoint(I)}var C={dts:S,pts:w,cts:k,size:L,isKeyframe:p,duration:A,originalDts:g,flags:{isLeading:0,dependsOn:p?2:1,isDependedOn:p?1:0,hasRedundancy:0,isNonSync:p?0:1}};_.push(C)}var x=_[_.length-1];s=x.dts+x.duration;l=x.pts+x.duration;this._videoNextDts=s;v.beginDts=a;v.endDts=s;v.beginPts=u;v.endPts=l;v.originalBeginDts=_[0].originalDts;v.originalEndDts=x.originalDts+x.duration;v.firstSample=new h.SampleInfo(_[0].dts,_[0].pts,_[0].duration,_[0].originalDts,_[0].isKeyframe);v.lastSample=new h.SampleInfo(x.dts,x.pts,x.duration,x.originalDts,x.isKeyframe);if(!this._isLive){this._videoSegmentInfoList.append(v)}var M=r.samples[0];r.samples=_;r.sequenceNumber++;if(this._forceFirstIDR){var D=_[0].flags;D.dependsOn=2;D.isNonSync=0}var j=o.default.moof(r,a);r.samples=[];r.length=0;r.samples.push(M);r.length=M.length;this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(j,d).buffer,sampleCount:_.length,info:v})}},{key:"_mergeBoxes",value:function e(t,r){var i=new Uint8Array(t.byteLength+r.byteLength);i.set(t,0);i.set(r,t.byteLength);return i}},{key:"onInitSegment",get:function e(){return this._onInitSegment},set:function e(t){this._onInitSegment=t}},{key:"onMediaSegment",get:function e(){return this._onMediaSegment},set:function e(t){this._onMediaSegment=t}}]);return e}();r.default=m},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i={};function n(){var e=self.navigator.userAgent.toLowerCase();var t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];var r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[];var n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""};var a={};if(n.browser){a[n.browser]=true;var s=n.majorVersion.split(".");a.version={major:parseInt(n.majorVersion,10),string:n.version};if(s.length>1){a.version.minor=parseInt(s[1],10)}if(s.length>2){a.version.build=parseInt(s[2],10)}}if(n.platform){a[n.platform]=true}if(a.chrome||a.opr||a.safari){a.webkit=true}if(a.rv||a.iemobile){if(a.rv){delete a.rv}var o="msie";n.browser=o;a[o]=true}if(a.edge){delete a.edge;var u="msedge";n.browser=u;a[u]=true}if(a.opr){var l="opera";n.browser=l;a[l]=true}if(a.safari&&a.android){var f="android";n.browser=f;a[f]=true}a.name=n.browser;a.platform=n.platform;for(var d in i){if(i.hasOwnProperty(d)){delete i[d]}}Object.assign(i,a)}n();r.default=i},{}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=r.RuntimeException=function(){function e(t){s(this,e);this._message=t}i(e,[{key:"toString",value:function e(){return this.name+": "+this.message}},{key:"name",get:function e(){return"RuntimeException"}},{key:"message",get:function e(){return this._message}}]);return e}();var u=r.IllegalStateException=function(e){a(t,e);function t(e){s(this,t);return n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}i(t,[{key:"name",get:function e(){return"IllegalStateException"}}]);return t}(o);var l=r.InvalidArgumentException=function(e){a(t,e);function t(e){s(this,t);return n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}i(t,[{key:"name",get:function e(){return"InvalidArgumentException"}}]);return t}(o);var f=r.NotImplementedException=function(e){a(t,e);function t(e){s(this,t)
;return n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}i(t,[{key:"name",get:function e(){return"NotImplementedException"}}]);return t}(o)},{}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e)}i(e,null,[{key:"e",value:function t(r,i){if(!e.ENABLE_ERROR){return}if(!r||e.FORCE_GLOBAL_TAG)r=e.GLOBAL_TAG;var n="["+r+"] > "+i;if(console.error){console.error(n)}else if(console.warn){console.warn(n)}else{console.log(n)}}},{key:"i",value:function t(r,i){if(!e.ENABLE_INFO){return}if(!r||e.FORCE_GLOBAL_TAG)r=e.GLOBAL_TAG;var n="["+r+"] > "+i;if(console.info){console.info(n)}else{console.log(n)}}},{key:"w",value:function t(r,i){if(!e.ENABLE_WARN){return}if(!r||e.FORCE_GLOBAL_TAG)r=e.GLOBAL_TAG;var n="["+r+"] > "+i;if(console.warn){console.warn(n)}else{console.log(n)}}},{key:"d",value:function t(r,i){if(!e.ENABLE_DEBUG){return}if(!r||e.FORCE_GLOBAL_TAG)r=e.GLOBAL_TAG;var n="["+r+"] > "+i;if(console.debug){console.debug(n)}else{console.log(n)}}},{key:"v",value:function t(r,i){if(!e.ENABLE_VERBOSE){return}if(!r||e.FORCE_GLOBAL_TAG)r=e.GLOBAL_TAG;console.log("["+r+"] > "+i)}}]);return e}();a.GLOBAL_TAG="flv.js";a.FORCE_GLOBAL_TAG=false;a.ENABLE_ERROR=true;a.ENABLE_INFO=true;a.ENABLE_WARN=true;a.ENABLE_DEBUG=true;a.ENABLE_VERBOSE=true;r.default=a},{}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var n=e("events");var a=u(n);var s=e("./logger.js");var o=u(s);function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function e(){l(this,e)}i(e,null,[{key:"getConfig",value:function e(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR}}},{key:"applyConfig",value:function e(t){o.default.GLOBAL_TAG=t.globalTag;o.default.FORCE_GLOBAL_TAG=t.forceGlobalTag;o.default.ENABLE_VERBOSE=t.enableVerbose;o.default.ENABLE_DEBUG=t.enableDebug;o.default.ENABLE_INFO=t.enableInfo;o.default.ENABLE_WARN=t.enableWarn;o.default.ENABLE_ERROR=t.enableError}},{key:"_notifyChange",value:function t(){var r=e.emitter;if(r.listenerCount("change")>0){var i=e.getConfig();r.emit("change",i)}}},{key:"registerListener",value:function t(r){e.emitter.addListener("change",r)}},{key:"removeListener",value:function t(r){e.emitter.removeListener("change",r)}},{key:"forceGlobalTag",get:function e(){return o.default.FORCE_GLOBAL_TAG},set:function t(r){o.default.FORCE_GLOBAL_TAG=r;e._notifyChange()}},{key:"globalTag",get:function e(){return o.default.GLOBAL_TAG},set:function t(r){o.default.GLOBAL_TAG=r;e._notifyChange()}},{key:"enableAll",get:function e(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function t(r){o.default.ENABLE_VERBOSE=r;o.default.ENABLE_DEBUG=r;o.default.ENABLE_INFO=r;o.default.ENABLE_WARN=r;o.default.ENABLE_ERROR=r;e._notifyChange()}},{key:"enableDebug",get:function e(){return o.default.ENABLE_DEBUG},set:function t(r){o.default.ENABLE_DEBUG=r;e._notifyChange()}},{key:"enableVerbose",get:function e(){return o.default.ENABLE_VERBOSE},set:function t(r){o.default.ENABLE_VERBOSE=r;e._notifyChange()}},{key:"enableInfo",get:function e(){return o.default.ENABLE_INFO},set:function t(r){o.default.ENABLE_INFO=r;e._notifyChange()}},{key:"enableWarn",get:function e(){return o.default.ENABLE_WARN},set:function t(r){o.default.ENABLE_WARN=r;e._notifyChange()}},{key:"enableError",get:function e(){return o.default.ENABLE_ERROR},set:function t(r){o.default.ENABLE_ERROR=r;e._notifyChange()}}]);return e}();f.emitter=new a.default;r.default=f},{"./logger.js":41,events:2}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function t(){n(this,t)}i(t,null,[{key:"install",value:function t(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e};Object.assign=Object.assign||function(e){if(e===undefined||e===null){throw new TypeError("Cannot convert undefined or null to object")}var t=Object(e);for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i!==undefined&&i!==null){for(var n in i){if(i.hasOwnProperty(n)){t[n]=i[n]}}}}return t};if(typeof self.Promise!=="function"){e("es6-promise").polyfill()}}}]);return t}();a.install();r.default=a},{"es6-promise":1}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function i(e,t,r){var i=e;if(t+r<i.length){while(r--){if((i[++t]&192)!==128)return false}return true}else{return false}}function n(e){var t=[];var r=e;var n=0;var a=e.length;while(n<a){if(r[n]<128){t.push(String.fromCharCode(r[n]));++n;continue}else if(r[n]<192){}else if(r[n]<224){if(i(r,n,1)){var s=(r[n]&31)<<6|r[n+1]&63;if(s>=128){t.push(String.fromCharCode(s&65535));n+=2;continue}}}else if(r[n]<240){if(i(r,n,2)){var o=(r[n]&15)<<12|(r[n+1]&63)<<6|r[n+2]&63;if(o>=2048&&(o&63488)!==55296){t.push(String.fromCharCode(o&65535));n+=3;continue}}}else if(r[n]<248){if(i(r,n,3)){var u=(r[n]&7)<<18|(r[n+1]&63)<<12|(r[n+2]&63)<<6|r[n+3]&63;if(u>65536&&u<1114112){u-=65536;t.push(String.fromCharCode(u>>>10|55296));t.push(String.fromCharCode(u&1023|56320));n+=4;continue}}}t.push(String.fromCharCode(65533));++n}return t.join("")}r.default=n},{}]},{},[21])(21)});function liveplay(e,t,r){if(!flvjs.isSupported())console.log("flv dont supported");var i=flvjs.createPlayer({type:"flv",isLive:true,url:t},{enableStashBuffer:true});i.attachMediaElement(e);i.load();i.play();e.flvPlayer=i;if(r){e.fivPlayerTimer=setTimeout(function(){liveplaystop(e);liveplay(e,t)},r)}i.on(flvjs.Events.ERROR,function(r,n){console.log("type:"+r+" details:"+n);switch(r){case"NetworkError":i.unload();setTimeout(function(){i.load();i.play()},1e3);break;case"MediaError":i.pause();i.unload();setTimeout(function(){liveplaystop(e);liveplay(e,t)},1e3);break;default:}});return i}function livePlay(e,t,r){if(!flvjs.isSupported())console.log("flv dont supported");var i=flvjs.createPlayer({type:"flv",isLive:true,url:t},{enableStashBuffer:true});i.attachMediaElement(e);i.load();/*i.play();*/e.flvPlayer=i;if(r){e.fivPlayerTimer=setTimeout(function(){liveplaystop(e);liveplay(e,t)},r)}i.on(flvjs.Events.ERROR,function(r,n){console.log("type:"+r+" details:"+n);switch(r){case"NetworkError":i.unload();setTimeout(function(){i.load();i.play()},1e3);break;case"MediaError":i.pause();i.unload();setTimeout(function(){liveplaystop(e);liveplay(e,t)},1e3);break;default:}});return i}function playstart(e,t,r){if(!flvjs.isSupported())console.log("flv dont supported");var i=flvjs.createPlayer({type:"flv",isLive:false,url:t,duration:r},{enableStashBuffer:false,lazyLoad:true,lazyLoadMaxDuration:40,lazyLoadRecoverDuration:5,seekType:"param",seekParamStart:"start"});i.attachMediaElement(e);i.load();i.play();e.flvPlayer=i;i.on(flvjs.Events.ERROR,function(e,t){console.log("type:"+e+" details:"+t)});return i}function liveplaystop(e){if(e.flvPlayer){e.flvPlayer.destroy();e.flvPlayer=null}if(e.fivPlayerTimer){clearTimeout(e.fivPlayerTimer)}}function captureimage(e,t){var r=document.createElement("canvas");var i=r.getContext("2d");r.width=e.videoWidth;r.height=e.videoHeight;i.drawImage(e,0,0,r.width,r.height);var n=r.toDataURL();var a=function(e,t){var r=document.createElementNS("http://www.w3.org/1999/xhtml","a");r.href=e;r.download=t;var i=document.createEvent("MouseEvents");i.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);r.dispatchEvent(i)};a(n,t)}function showsub(e,t){var r=e.textTracks[0];if(!r){r=e.addTextTrack("subtitles","sample");r.mode="showing";window["VTTCue"]=window["VTTCue"]||window["TextTrackCue"]}var i=r.cues[0];if(i){r.removeCue(i)}i=new VTTCue(0,99999,t);i.line=0;i.align="start";r.addCue(i)}export default {livePlay,livePlayStop:liveplaystop};
